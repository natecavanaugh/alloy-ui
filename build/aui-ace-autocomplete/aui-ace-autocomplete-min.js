AUI.add("aui-ace-autocomplete",function(u){var af=u.Lang,z=u.Array,L=u.Do,ac="exec",j="processor",l=-1,X=0,M="ace-autocomplete-base";var p=function(){};p.prototype={initializer:function(){var A=this;A._editorCommands=[];u.after(this._bindUIACBase,this,"renderUI");},_addSuggestion:function(ah){var A=this;var ag=A._getEditor();var ai=A.get(j).getSuggestion(A._enteringParams.match,ah);ag.insert(ai);ag.focus();A.fire("addSuggestion",ai);return new L.Halt(null);},_bindUIACBase:function(){var A=this;A.publish("cursorChange",{defaultFn:A._defaultCursorChangeFn});var ag=A._getEditor();ag.on("change",u.bind(A._onEditorChange,A));ag.commands.addCommand({name:"showAutoComplete",bindKey:u.merge(A.get("showListKey"),{sender:"editor|cli"}),exec:function(aj,ai,ak){var ah=ag.getCursorPosition();A._processAutoComplete(ah.row,ah.column);}});ag.getSelection().on("changeCursor",u.bind(A._onEditorChangeCursor,A));A.on("destroy",A._destroyUIACBase,A);},_destroyUIACBase:function(){var A=this;A._removeAutoCompleteCommands();},_defaultCursorChangeFn:function(A){var al=this;var ai=al._getEditor();var ag=ai.getCursorPosition();var am=ag.row;var ah=ag.column;var aj=al._enteringParams;if(am!==aj.row||ah<aj.match.start){al.fire("cursorOut");}else{var an=ai.getSession().getLine(am);var ak=an.substring(aj.match.start,ah);if(!al.get(j).getMatch(ak)){al.fire("match");}}},_getEditor:function(){var A=this;return A.get("host").getEditor();},_handleEnter:function(ah){var A=this;if(ah==="\n"||ah==="\t"){var ag=A._getSelectedEntry();return A._addSuggestion(ag);}},_onEditorChange:function(ak){var A=this;var al=ak.data;var am=al.action;if(am==="insertText"||am==="removeText"){var ai=al.range;var aj=ai.start.column;var ah=ai.end.row;var ag=ai.start.row;if(am==="insertText"&&ag===ah){A._processAutoComplete(ag,aj+1);}A.fire(am,{column:aj,dataRange:ai,endRow:ah,startRow:ag});}},_onEditorChangeCursor:function(ag){var A=this;A.fire("cursorChange",A._getEditor().getCursorPosition());},_onResultsError:function(ag){var A=this;A.fire("resultsError",ag);},_onResultsSuccess:function(ag){var A=this;A.set("results",ag);},_overwriteCommands:function(){var ag=this;var ah=ag._getEditor();var A=ah.commands.commands;ag._editorCommands.push(L.before(ag._handleEnter,ah,"onTextInput",this),L.before(ag._handleKey,A["golinedown"],ac,this,40),L.before(ag._handleKey,A["golineup"],ac,this,38),L.before(ag._handleKey,A["gotoend"],ac,this,35),L.before(ag._handleKey,A["gotolineend"],ac,this,35),L.before(ag._handleKey,A["gotolinestart"],ac,this,36),L.before(ag._handleKey,A["gotopagedown"],ac,this,34),L.before(ag._handleKey,A["gotopageup"],ac,this,33),L.before(ag._handleKey,A["gotostart"],ac,this,36));},_processAutoComplete:function(am,ah){var al=this;var ag=ah;var aj=al._getEditor();var an=aj.getSession().getLine(am);an=an.substring(0,ah);var A=al.get(j);var ai=A.getMatch(an);var ak;if(af.isObject(ai)){ak=aj.renderer.textToScreenCoordinates(am,ah);al._enteringParams={column:ah,match:ai,row:am};A.getResults(ai,u.bind(al._onResultsSuccess,al),u.bind(al._onResultsError,al));}al.fire("match",{column:ah,coords:ak,line:an,match:ai,row:am});},_removeAutoCompleteCommands:function(){var A=this;z.invoke(A._editorCommands,"detach");A._editorCommands.length=0;}};p.NAME=M;p.NS=M;p.ATTRS={processor:{validator:function(A){return af.isObject(A)||af.isFunction(A);}},showListKey:{validator:af.isObject,value:{mac:"Alt-Space",win:"Ctrl-Space"}}};u.AceEditor.AutoCompleteBase=p;var af=u.Lang,z=u.Array,L=u.Do,g=u.getClassName,Z="data-index",M="ace-autocomplete-list",d="container",D=".",e="empty",n="",N="entry",H="highlighted",Q="list",C="loading",O="offsetHeight",I="region",aa="results",J="selected",a=" ",ae="visible",t="ace-autocomplete",i=g(t,N),V=g(t,N,d),G=g(t,N,d,H),Y=g(t,N,C),y=g(t,N,e),P=g(t,N,C),f=g(t,aa),U=D+V,s=U+D+J,ab=s+a+D+i,w=40,m=35,W=34,F=33,h=36,S=38,R=5,T=20;var K=u.Component.create({NAME:M,NS:M,ATTRS:{emptyMessage:{validator:af.isString,value:"No suggestions"},host:{validator:af.isObject},listNode:{value:null},loadingMessage:{validator:af.isString,value:"Loading"},results:{validator:af.isArray},selectedEntry:{getter:"_getSelectedEntry"}},AUGMENTS:[u.AceEditor.AutoCompleteBase,u.WidgetAutohide],CSS_PREFIX:t,EXTENDS:u.OverlayBase,HTML_PARSER:{listNode:D+f},prototype:{bindUI:function(){var A=this;A.on("addSuggestion",A.hide,A);A.on("cursorChange",A._onCursorChange,A);A.on("cursorOut",A.hide,A);A.on("insertText",A._onInsertText,A);A.on("match",A._onMatch,A);A.on("removeText",A._onRemoveText,A);A.on("resultsChange",A._onResultsChange,A);A.on("resultsError",A._setEmptyResults,A);A.on("visibleChange",A._onVisibleChange,A);},renderUI:function(){var A=this;var ag=A.get("listNode");if(!ag){ag=A._createListNode();}ag.delegate("click",A._handleResultListClick,U,A);ag.delegate("mouseenter",A._onMouseEnter,U,A);ag.delegate("mouseleave",A._onMouseLeave,U);A._autoCompleteResultsList=ag;},_createListNode:function(){var A=this;var ag=u.Node.create(A.TPL_LIST);A.get("contentBox").append(ag);return ag;},_getEntriesPerPage:function(){var A=this;var ah=A._entriesPerPage;if(!ah){var ag=A._autoCompleteResultsList;var ai=ag.one(U).get(O);var aj=ag.get(O);ah=Math.floor(aj/ai);A._entriesPerPage=ah;}return ah;},_getSelectedEntry:function(){var A=this;var ag;var ah=A._autoCompleteResultsList.one(ab);if(ah){ag=ah.text();}return ag;},_handleArrows:function(al){var A=this;var ak;if(al===S){ak="previous";}else{if(al===w){ak="next";}}if(ak){var ai=A._autoCompleteResultsList;var ah=ai.one(s);if(ah){var aj=ah[ak](U);if(aj){ah.removeClass(J);aj.addClass(J);var am=ai.get(I);var ag=aj.get(I);if(ak==="previous"){if(ag.top<am.top){aj.scrollIntoView(true);}else{if(ag.top>am.bottom){aj.scrollIntoView();}}}else{if(ag.top+ag.height>am.bottom){aj.scrollIntoView();}else{if(ag.top+ag.height<am.top){aj.scrollIntoView(true);}}}}}return new L.Halt(null);}},_handleKey:function(ah,aj,ai){var ag=this;var A;if(ag.get(ae)){if(ai===S||ai===w){A=ag._handleArrows(ai);}else{if(ai===F||ai===W){A=ag._handlePageUpDown(ai);}else{if(ai===m||ai===h){A=ag._handleStartEnd(ai);
}}}}return A;},_handlePageUpDown:function(an){var al=this;var ai=al._autoCompleteResultsList;var am=al._getEntriesPerPage();var ak=ai.one(s);var A=parseInt(ak.attr(Z),0);var aj;var ao=n;var ag=false;if(an===F){aj=A-am;ag=true;}else{if(an===W){aj=A+am;ao=":last-child";}}var ah=ai.one(U+"["+Z+'="'+aj+'"]');if(!ah){ah=ai.one(U+ao);}if(ak!==ah){ak.removeClass(J);ah.addClass(J);ah.scrollIntoView(ag);}return new L.Halt(null);},_handleResultListClick:function(ai){var A=this;var aj=ai.currentTarget;var ag=A._autoCompleteResultsList.one(s);if(aj!==ag){ag.removeClass(J);aj.addClass(J);}var ah=aj.text();A._addSuggestion(ah);A.fire("entrySelected",{content:ah});},_handleStartEnd:function(ak){var A=this;var ai;var aj=false;var ah=A._autoCompleteResultsList;if(ak===m){ai=ah.one(U+":last-child");}else{if(ak===h){ai=ah.one(U);aj=true;}}var ag=ah.one(s);if(ai!==ag){ag.removeClass(J);ai.addClass(J);ai.scrollIntoView(aj);}return new L.Halt(null);},_onCursorChange:function(ag){var A=this;if(!A.get(ae)){ag.preventDefault();}},_onInsertText:function(ag){var A=this;if(ag.startRow!==ag.endRow&&A.get(ae)){A.hide();}},_onMatch:function(ag){var A=this;if(ag.match){var ah=ag.coords;A.set("xy",[ah.pageX+R,ah.pageY+T]);if(!A.get(ae)){A.show();}}else{if(A.get(ae)){A.hide();}}},_onMouseEnter:function(A){A.currentTarget.addClass(G);},_onMouseLeave:function(A){A.currentTarget.removeClass(G);},_onRemoveText:function(ag){var A=this;if(A.get(ae)){A.hide();}},_onResultsChange:function(ak){var A=this;var ag=A._autoCompleteResultsList;ag.empty();var ai=ak.newVal;var aj=A.TPL_ENTRY;z.each(ai,function(am,al){ag.appendChild(af.sub(aj,{index:al,value:am}));});var ah=ag.one(U);if(ah){ah.addClass(J);}else{ag.appendChild(af.sub(A.TPL_RESULTS_EMPTY,{label:A.get("emptyMessage")}));}},_onVisibleChange:function(ah){var A=this;var ag=A._autoCompleteResultsList;if(ah.newVal){A._overwriteCommands();}else{A._removeAutoCompleteCommands();ag.empty();ag.appendChild(af.sub(A.TPL_LOADING,{label:A.get("loadingMessage")}));}},_setEmptyResults:function(){var A=this;A.set("results",[]);},TPL_ENTRY:'<li class="'+V+'" data-index="{index}">'+'<span class="'+i+'">{value}</span>'+"</li>",TPL_LIST:'<ul class="'+f+'"/>',TPL_LOADING:'<li class="'+V+'">'+'<span class="aui-icon-loading '+Y+'">{label}</span>'+"</li>",TPL_RESULTS_EMPTY:'<li class="'+V+'">'+'<span class="'+y+'">{label}</span>'+"</li>"}});u.AceEditor.AutoCompleteList=K;u.AceEditor.AutoComplete=K;var af=u.Lang,z=u.Array,x=u.Object,b=["flush","recover","fallback","local","break","lt","case","global","if","compress","escape","assign","elseif","noescape","setting","list","else","switch","include","recurse","rt","ftl","macro","stop","nt","visit","attempt","nested","import","default","return","t","function"],o=0,v=1,c=/<#[\w.]*>?$/,r=/\$\{[\w.]*\}?$/,l=-1,X=0,D=".",ad="responseData",q="",M="aui-ace-autocomplete-freemarker";var k=u.Component.create({NAME:M,NS:M,ATTRS:{io:{validator:af.isObject}},EXTENDS:u.Base,prototype:{initializer:function(ag){var A=this;A._tstree=new u.TernarySearchTree();A._variableCache={};},getMatch:function(ai){var ag=this;var ah;var A;if((A=ai.lastIndexOf("<"))>=0){ai=ai.substring(A);if(c.test(ai)){ah={content:ai.substring(2),start:A,type:o};}}else{if((A=ai.lastIndexOf("$"))>=0){ai=ai.substring(A);if(r.test(ai)){ah={content:ai.substring(2),start:A,type:v};}}}return ah;},getResults:function(ag,an,al){var ao=this;var ah=ao._tstree;var ak=ag.type;if(ak===o){var aj=b;var ai=ag.content;if(ai.length){if(ao._lastTSTLoad!==o){ao._addDirectives();}aj=ah.prefixSearch(ai);}an(aj);}else{if(ak===v){var am=ao._getUncachedVariables(ag.content);if(am.length){ao._loadUncachedVariables(ag,am,an,al);}else{var A=ao._getVariableMatches(ag.content);an(A);}}}},getSuggestion:function(ai,aj){var ag=this;var A=aj||q;if(aj){var ak=ai.type;if(ak===o){if(ai.content&&aj.indexOf(ai.content)===0){A=aj.substring(ai.content.length);}}else{if(ak===v){var al=ai.content.split(D);var ah=al[al.length-1];if(ah&&aj.indexOf(ah)===0){A=aj.substring(ah.length);}}}}return A;},_addData:function(ah){var A=this;var ag=A._tstree;ag.empty();z.each(ah,function(aj,ai){ag.add(aj);});},_addDirectives:function(){var A=this;A._addData(b);A._lastTSTLoad=o;},_cacheVariables:function(ah){var A=this;var ag=A._variableCache;x.each(ah,function(ak,ai){var aj=ag[ai];if(x.isEmpty(aj)){aj=aj||{};z.each(ak,function(am,al){aj[am]={};});ag[ai]=aj;}ag=aj;});},_getIO:function(){var A=this;var ag=A._io;if(!ag){ag=u.io.request(null,{autoLoad:false,dataType:"json",on:{success:function(aj,al,ak,ai){var ah=this.get(ad);A._onIOSuccess(ah,ai);},failure:function(aj,al,ak,ai){var ah=this.get(ad);A._onIOFailure(ah,ai);}}});A._io=ag;}return ag;},_getVariableMatches:function(ak){var am=this;var an=ak.split(D);var A=am._variableCache;var al=an[an.length-1];an.length-=1;var ag;if(an.length>0){for(var ah=0;ah<an.length;ah++){ag=an[ah];if(af.isObject(A)){A=A[ag];}}}var ai=[];if(af.isObject(A)){z.each(x.keys(A),function(ap,ao){ai.push(ap);});if(al){var aj=am._tstree;aj.empty();z.each(ai,function(ap,ao){aj.add(ap);});ai=aj.prefixSearch(al);am._lastTSTLoad=v;}}return ai;},_makeIORequest:function(aj,ah,ai,ak){var A=this;var ag=A.get("io");var al=A._getIO();al.stop();al.setAttrs({"arguments":u.merge({callbacks:{success:ai,failure:ak}},ah),data:u.merge(ag.data||{},aj),uri:ag.uri});al.start();},_getUncachedVariables:function(ai){var A=this;var al=ai.split(D);al.length-=1;var ak=A._variableCache;var ag=[];if(x.isEmpty(ak)){ag.push(q);}var aj;for(var ah=0;ah<al.length;ah++){aj=al[ah];if(!af.isObject(ak)||!af.isValue(ak[aj])){ag.push(aj);}else{ak=ak[aj];}}return ag;},_loadUncachedVariables:function(ag,aj,ai,ak){var A=this;var ah={test:["test1","test11","test1123","test141234","test16345","test1567","test1sdfg","b","c"],test1:["test2","e","f"],test2:["test3","g","i"]};window.setTimeout(function(){console.log("_loadUncachedVariables loaded");A._cacheVariables(ah);var al=A._getVariableMatches(ag.content);ai(al);},1000);},_onIOFailure:function(ag,ah){var A=this;if(af.isFunction(ah.callbacks.success)){ah.callbacks.failure(ag);
}},_onIOSuccess:function(ag,ah){var A=this;ah.callbacks.success(ag);}}});k.DIRECTIVES=b;u.AceEditor.AutoCompleteFreemarker=k;var B=u.Plugin;function E(A){if(!A.render&&A.render!==false){A.render=true;}E.superclass.constructor.apply(this,arguments);}u.extend(E,u.AceEditor.AutoCompleteList,{},{CSS_PREFIX:"aui-ace-autocomplete",NAME:"aui-ace-autocomplete-plugin",NS:"aui-ace-autocomplete-plugin"});B.AceAutoComplete=E;B.AceAutoCompleteList=E;},"@VERSION@",{requires:["aui-ace-editor","aui-overlay-base","plugin","aui-search-ternary-search-tree","aui-io-request","widget-autohide"],skinnable:true});