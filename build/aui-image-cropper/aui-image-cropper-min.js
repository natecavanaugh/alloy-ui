AUI.add("aui-image-cropper",function(b){var a=b.Lang,e=a.isBoolean,d=a.isNumber,f="image-cropper",c=b.getClassName(f,"crop"),h=b.getClassName(f,"overlay");var g=b.Component.create({NAME:f,ATTRS:{cropHeight:{value:100,validator:d},cropWidth:{value:100,validator:d},minWidth:{value:undefined},minHeight:{value:undefined},movable:{value:true,validator:e},node:{setter:b.one},preserveRatio:{value:true,validator:e},resizable:{value:true,validator:e},x:{value:0,validator:d},y:{value:0,validator:d}},EXTENDS:b.Widget,UI_ATTRS:["cropHeight","cropWidth","minWidth","minHeight","movable","resizable","x","y"],prototype:{bindUI:function(){var i=this;i._bindDrag();i._bindResize();i.cropNode.hover(b.bind(i._showOverlay,i),b.bind(i._hideOverlay,i));},destructor:function(){var i=this;i._destroyDrag();i._destroyResize();},getCropRegion:function(){var i=this;var k=i.get("srcNode");var j=i.cropNode;return{"x":j.getX()-k.getX(),"y":j.getY()-k.getY(),"width":j.width(),"height":j.height()};},renderUI:function(){var j=this;var l=j.get("boundingBox");var p=j.get("srcNode");var k=b.Node.create('<div class="'+c+'"></div>');l.append(k);j.cropNode=k;var i=b.Node.create('<div class="'+h+'"></div>');var n=b.Node.create('<div class="'+h+'"></div>');var m=b.Node.create('<div class="'+h+'"></div>');var o=b.Node.create('<div class="'+h+'"></div>');l.append(i);l.append(n);l.append(m);l.append(o);j.topOverlay=i;j.rightOverlay=n;j.bottomOverlay=m;j.leftOverlay=o;j._renderDrag();j._renderResize();j._hideOverlay();},syncUI:function(){var i=this;i._uiSetX(i.get("x"));i._uiSetY(i.get("y"));i._uiSetCropWidth(i.get("cropWidth"));i._uiSetCropHeight(i.get("cropHeight"));i._uiSetPreserveRatio(i.get("preserveRatio"));i._uiSetMinWidth(i.get("minWidth"));i._uiSetMinHeight(i.get("minHeight"));i._uiSetMovable(i.get("movable"));i._uiSetResizable(i.get("resizable"));},_bindDrag:function(){var i=this;var j=i.drag;j.on("drag:drag",function(k){i._positionOverlay();});j.on("drag:start",function(k){i._showOverlay();});j.on("drag:end",function(k){i._hideOverlay();});},_bindResize:function(){var i=this;var j=i.resize;j.on("resize:resize",function(k){i._positionOverlay();});j.on("resize:start",function(k){i._showOverlay();});j.on("resize:end",function(k){i._hideOverlay();});},_destroyDrag:function(j){var i=this;if(i.drag){i.drag.destroy();delete i.drag;}},_destroyResize:function(j){var i=this;if(i.resize){i.resize.destroy();delete i.resize;}},_hideOverlay:function(){var i=this;if(i._isDragging()||i._isResizing()){return;}i.topOverlay.setStyle("visibility","hidden");i.rightOverlay.setStyle("visibility","hidden");i.bottomOverlay.setStyle("visibility","hidden");i.leftOverlay.setStyle("visibility","hidden");},_isDragging:function(){var i=this;var j=i.drag;if(j){return j.get("dragging");}else{return false;}},_isResizing:function(){var i=this;var j=i.resize;if(j){return j.get("resizing");}else{return false;}},_positionOverlay:function(v){var x=this;var r=x.get("srcNode");var u=x.cropNode;var m=x.topOverlay;var n=x.rightOverlay;var w=x.bottomOverlay;var q=x.leftOverlay;var o=r.getXY();var j=o[0];var i=o[1];var p=r.width();var y=r.height();var z=u.getXY();var t=z[0];var s=z[1];var k=u.width();var l=u.height();m.setXY([j,i]);m.width(p);m.height(s-i);n.setXY([t+k,s]);n.width(p-(t+k-j));n.height(l);w.setXY([j,s+l]);w.width(p);w.height(y-(s+l-i));q.setXY([j,s]);q.width(t-j);q.height(l);},_renderDrag:function(){var i=this;var l=i.get("srcNode");var j=i.cropNode;var k=new b.DD.Drag({node:j}).plug(b.Plugin.DDConstrained,{constrain2node:l});i.drag=k;},_renderResize:function(){var i=this;var l=i.get("srcNode");var k=i.cropNode;var j=new b.Resize({node:k,autoHide:true}).plug(b.Plugin.ResizeConstrained,{constrain:l,preserveRatio:i.get("preserveRatio"),minHeight:i.get("minHeight"),minWidth:i.get("minWidth")});i.resize=j;},_showOverlay:function(){var i=this;if(i._isDragging()||i._isResizing()){return;}i.topOverlay.setStyle("visibility","visible");i.rightOverlay.setStyle("visibility","visible");i.bottomOverlay.setStyle("visibility","visible");i.leftOverlay.setStyle("visibility","visible");},_uiSetCropHeight:function(l){var p=this;var n=p.get("srcNode");var o=p.cropNode;var m=n.getY();var i=n.height();var r=o.getY();var q=o.height();if(r+l>m+i){l=m+i-r;}o.height(l);if(p.get("preserveRatio")){var k=o.width();var j=k/q;o.width(l*j);}p._positionOverlay();},_uiSetCropWidth:function(k){var p=this;var m=p.get("srcNode");var o=p.cropNode;var n=m.getX();var j=m.width();var r=o.getX();var l=o.width();if(r+k>n+j){k=n+j-r;}o.width(k);if(p.get("preserveRatio")){var q=o.height();var i=q/l;o.height(k*i);}p._positionOverlay();},_uiSetMinHeight:function(k){var i=this;var j=i.resize;if(j){j.con.set("minHeight",k);}},_uiSetMinWidth:function(k){var i=this;var j=i.resize;if(j){j.con.set("minWidth",k);}},_uiSetMovable:function(j){var i=this;i.drag.set("lock",!j);},_uiSetPreserveRatio:function(k){var i=this;var j=i.resize;if(j){j.con.set("preserveRatio",k);}},_uiSetResizable:function(j){var i=this;if(j){if(i.stopResize){i.stopResize.detach();}}else{if(!i.stopResize){i.stopResize=i.resize.on("resize:resize",function(k){k.preventDefault();k.stopPropagation();});console.log(i.stopResize);}}},_uiSetX:function(n){var i=this;var o=i.get("srcNode");var k=i.cropNode;var m=o.getX();var j=o.width();var l=k.width();if(n+l>j){n=j-l;}k.setX(m+n);i._positionOverlay();},_uiSetY:function(n){var j=this;var o=j.get("srcNode");var l=j.cropNode;var m=o.getY();var i=o.height();var k=l.height();if(n+k>i){n=i-k;}l.setY(m+n);j._positionOverlay();}}});b.ImageCropper=g;},"@VERSION@",{requires:["widget","aui-base","resize","dd-constrain"],skinnable:true});