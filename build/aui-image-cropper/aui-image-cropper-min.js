AUI.add("aui-image-cropper",function(b){var f=b.Lang,a=f.isBoolean,g=f.isNumber,i="image-cropper",d=b.getClassName(i,"crop"),e=b.getClassName(i,"crop","outline"),c=b.getClassName(i,"overlay");CSS_OVERLAY_HOVER=b.getClassName(i,"crop","hover");var h=b.Component.create({NAME:i,ATTRS:{cropHeight:{value:100,validator:g},cropWidth:{value:100,validator:g},minWidth:{value:undefined},minHeight:{value:undefined},movable:{value:true,validator:a},preserveRatio:{value:false,validator:a},resizable:{value:true,validator:a},x:{value:0,setter:Math.round,validator:g},y:{value:0,setter:Math.round,validator:g}},UI_ATTRS:["cropHeight","cropWidth","minWidth","minHeight","movable","resizable","x","y"],prototype:{renderUI:function(){var j=this;var k=j.get("boundingBox");var l=j.get("srcNode");j.cropNode=b.Node.create('<div class="'+d+'"></div>');j.cropNode.append(b.Node.create('<div class="'+e+'"></div>'));j.overlay=b.Node.create('<div class="'+c+'"></div>');b.all([j.cropNode,j.overlay]).appendTo(k);j._boundingBox=k;j._renderDrag();j._renderResize();},bindUI:function(){var j=this;j.drag.addTarget(j);j.resize.addTarget(j);j.after("drag:drag",j._afterMove);j.after("resize:resize",j._afterResize);j.cropNode.hover(b.bind(j._hoverOverlay,j),b.bind(j._unHoverOverlay,j));},syncUI:function(){var j=this;j._uiSetPreserveRatio(j.get("preserveRatio"));j.afterImageChange();},destructor:function(){var j=this;j._destroyDrag();j._destroyResize();},afterImageChange:function(){var j=this;var l=j.get("srcNode");var k=j.overlay;j.cropNode.setStyle("backgroundImage","url("+l.attr("src")+")");k.setXY(l.getXY());k.width(l.width());k.height(l.height());j.constrainValues();j._afterMove();if(j.drag){j.drag.con.set("constrain",j._getConstraintRegion());}if(j.resize){j.resize.con.set("constrain",j._getConstraintRegion());}},constrainValues:function(){var s=this;var q=s.get("srcNode");var l=q.width();var k=q.height();var r=s.get("x");var p=s.get("y");var j=s.get("cropHeight");var u=s.get("cropWidth");var m=p;var n=r;var t=j;var o=u;if(m<0){m=0;}if(m+t>k){m=Math.max(k-t,0);}if(m!=p){s.set("y",m);}if(m+t>k){t=Math.max(k-m,0);}if(t!=j){s.set("cropHeight",t);}if(n<0){n=0;}if(n+o>l){n=Math.max(l-o,0);}if(n!=r){s.set("x",n);}if(n+o>l){o=Math.max(l-n,0);}if(o!=u){s.set("cropWidth",o);}},getCropRegion:function(){var j=this;return{x:j.get("x"),y:j.get("y"),width:j.get("cropWidth"),height:j.get("cropHeight")};},_afterMove:function(j){var s=this;var p=s.get("srcNode");var r=s.cropNode;var n=p.getXY();var q=n[0];var o=n[1];var k=r.getXY();var u=k[0];var t=k[1];var m=u-q+r.getBorderWidth("l");var l=t-o+r.getBorderWidth("t");r.setStyle("backgroundPosition",(-m)+"px "+(-l)+"px");s.set("x",m);s.set("y",l);},_afterResize:function(l){var j=this;var k=j.cropNode;j.set("cropHeight",k.height());j.set("cropWidth",k.width());},_destroyDrag:function(k){var j=this;if(j.drag){j.drag.destroy();delete j.drag;}},_destroyResize:function(k){var j=this;if(j.resize){j.resize.destroy();delete j.resize;}},_getConstraintRegion:function(){var j=this;var o=j.get("srcNode");var l=j.cropNode;var k=o.getXY();var n=k[0];var m=k[1];return{top:m-l.getBorderWidth("t"),right:n+o.width()+l.getBorderWidth("r"),bottom:m+o.height()+l.getBorderWidth("b"),left:n-l.getBorderWidth("l")};},_hoverOverlay:function(){var j=this;if(!j._isDragging()&&!j._isResizing()){j._boundingBox.addClass(CSS_OVERLAY_HOVER);}},_isDragging:function(){var j=this;var k=j.drag;return k&&k.get("dragging");},_isResizing:function(){var j=this;var k=j.resize;return k&&k.get("resizing");},_renderDrag:function(){var j=this;j.drag=new b.DD.Drag({node:j.cropNode}).plug(b.Plugin.DDConstrained,{constrain:j._getConstraintRegion()});},_renderResize:function(){var j=this;j.resize=new b.Resize({node:j.cropNode}).plug(b.Plugin.ResizeConstrained,{constrain:j._getConstraintRegion(),preserveRatio:j.get("preserveRatio"),minHeight:j.get("minHeight"),minWidth:j.get("minWidth")});},_uiSetCropHeight:function(k){var j=this;j.cropNode.height(k);},_uiSetCropWidth:function(k){var j=this;j.cropNode.width(k);},_uiSetMinHeight:function(l){var j=this;var k=j.resize;if(k){k.con.set("minHeight",l);}},_uiSetMinWidth:function(l){var j=this;var k=j.resize;if(k){k.con.set("minWidth",l);}},_uiSetMovable:function(k){var j=this;j.drag.set("lock",!k);},_uiSetPreserveRatio:function(l){var j=this;var k=j.resize;if(k){k.con.set("preserveRatio",l);}},_uiSetResizable:function(k){var j=this;if(k){if(j.stopResize){j.stopResize.detach();}}else{if(!j.stopResize){j.stopResize=j.resize.on("resize:resize",function(l){l.preventDefault();l.stopPropagation();});}}},_uiSetX:function(l){var j=this;var m=j.get("srcNode");var k=j.cropNode;k.setX(m.getX()+l-k.getBorderWidth("l"));},_uiSetY:function(l){var j=this;var m=j.get("srcNode");var k=j.cropNode;k.setY(m.getY()+l-k.getBorderWidth("t"));},_unHoverOverlay:function(){var j=this;if(!j._isDragging()&&!j._isResizing()){j._boundingBox.removeClass(CSS_OVERLAY_HOVER);}}}});b.ImageCropper=h;},"@VERSION@",{requires:["widget","aui-base","resize","dd-constrain"],skinnable:true});