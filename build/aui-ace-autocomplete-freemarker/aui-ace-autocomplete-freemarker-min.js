AUI.add("aui-ace-autocomplete-freemarker",function(q){var f=q.Lang,D=q.Array,B=q.Do,k="ace-autocomplete-freemarker",o=["assign","attempt","break","case","compress","default","else","elseif","escape","fallback","flush","ftl","function","global","if","import","include","list","local","lt","macro","nested","noescape","nt","recover","recurse","return","rt","setting","stop","switch","t","visit"];var y=q.Component.create({NAME:k,NS:k,ATTRS:{list:{readOnly:true,getter:function(){var A=this;return A._list;}},regex:{value:/<#[\w.]*$/},uiConfig:{value:{buttons:null,render:true,visible:false,width:250,zIndex:10000}}},EXTENDS:q.Plugin.Base,prototype:{initializer:function(I){var A=this;A._editorCommands=[];A._tstree=new q.TernarySearchTree();A.afterHostEvent("render",function(){A._renderUI();A._bindUI();});},destructor:function(){var A=this;A._removeAutoCompleteCommands();},_renderUI:function(){var A=this;var I=A.get("uiConfig");var J=new q.AceEditor.AutoCompleteList(I);J.on("visibleChange",function(K){if(K.newVal){A._overwriteCommands();}else{A._removeAutoCompleteCommands();}});J.on("entrySelected",A._insertWord,A);A._list=J;},_bindUI:function(){var A=this;var I=A._getEditor();I.on("change",q.bind(A._onEditorChange,A));I.getSelection().on("changeCursor",q.bind(A._onCursorChange,A));},_getEditor:function(){var A=this;return A.get("host").getEditor();},_insertWord:function(){var A=this;var I=A._getEditor();var J=A._list.get("selectedEntry");if(A._enteringParams.word){J=J.substring(A._enteringParams.word.length);}I.insert(J);A._list.hide();I.focus();return new B.Halt(null);},_handleEnter:function(I){var A=this;if(I==="\n"||I==="\t"){return A._insertWord();}},_handleKey:function(J,L,K){var I=this;var A;if(I._list.get("visible")){A=I._list.handleKey(K);}return A;},_onEditorChange:function(M){var A=this;var N=M.data;if(N.action==="insertText"){var K=N.range;var L=K.start.column;var J=K.end.row;var I=K.start.row;if(I===J){A._processAutoComplete(I,L+1);}else{if(A._list.get("visible")){A._list.hide();}}}else{if(N.action==="removeText"){if(A._list.get("visible")){A._list.hide();}}}},_onCursorChange:function(I){var O=this;var L=O._getEditor();var A=O._list;if(A.get("visible")){var J=L.getCursorPosition();var Q=J.row;var K=J.column;var M=O._enteringParams;if(Q!==M.row||K<M.lastBracketIndex){A.hide();}else{var P=L.getSession().getLine(Q);var N=P.substring(M.lastBracketIndex,K);if(!O.get("regex").test(N)){A.hide();}}}},_overwriteCommands:function(){var I=this;var J=I._getEditor();var A=J.commands.commands;I._editorCommands.push(B.before(I._handleEnter,J,"onTextInput",this),B.before(I._handleKey,A["golinedown"],"exec",this,40),B.before(I._handleKey,A["golineup"],"exec",this,38),B.before(I._handleKey,A["gotoend"],"exec",this,35),B.before(I._handleKey,A["gotolineend"],"exec",this,35),B.before(I._handleKey,A["gotolinestart"],"exec",this,36),B.before(I._handleKey,A["gotopagedown"],"exec",this,34),B.before(I._handleKey,A["gotopageup"],"exec",this,33),B.before(I._handleKey,A["gotostart"],"exec",this,36));},_processAutoComplete:function(R,L){var Q=this;var K=L;var M=Q._getEditor();var S=M.getSession().getLine(R);var P=S.substring(0,L);var J=P.lastIndexOf("<");var A=Q._list;if(J>=0){P=P.substring(J);if(Q.get("regex").test(P)){var O=M.renderer.textToScreenCoordinates(R,L);var I=P.substring(2);Q._enteringParams={column:L,lastBracketIndex:J,row:R,word:I};var N=o;if(I.length){N=Q._tstree.prefixSearch(I);}Q._list.set("results",N);A.set("xy",[O.pageX+5,O.pageY+20]);if(!A.get("visible")){A.show();}}}else{if(A.get("visible")){A.hide();}}},_removeAutoCompleteCommands:function(){var A=this;D.invoke(A._editorCommands,"detach");}}});q.AceEditor.AutoCompleteFreemarker=y;var f=q.Lang,D=q.Array,B=q.Do,E=q.getClassName,k="ace-autocomplete-list",t="container",H="empty",b="",u="entry",e="list",h="results",n=E(k,u),i=E(k,u,t),l=E(k,u,H),G=E(k,h),x=".",c="offsetHeight",s="region",g="selected",F=40,C=35,p=34,d=33,v=36,r=38,w="data-index",z=x+i,a=z+x+g,j=a+x+n;var m=q.Component.create({NAME:k,NS:k,ATTRS:{emptyMessage:{value:"No suggestions"},listNode:{value:null},results:{validator:f.isArray},selectedEntry:{getter:"_getSelectedEntry"}},HTML_PARSER:{listNode:x+G},EXTENDS:q.Panel,prototype:{initializer:function(A){},bindUI:function(){var A=this;A.on("resultsChange",A._onResultsChange,A);},handleKey:function(I){var A=this;if(I===r||I===F){return A._handleArrows(I);}else{if(I===d||I===p){return A._handlePageUpDown(I);}else{if(I===C||I===v){return A._handleStartEnd(I);}}}},renderUI:function(){var A=this;var I=A.get("listNode");if(!I){I=A._createListNode();}A._autoCompleteResultsList=I;},_createListNode:function(){var A=this;var I=q.Node.create(A.TPL_LIST);A.get("contentBox").append(I);return I;},_getEntriesPerPage:function(){var A=this;var J=A._entriesPerPage;if(!J){var I=A._autoCompleteResultsList;var K=I.one(z).get(c);var L=I.get(c);J=Math.floor(L/K);A._entriesPerPage=J;}return J;},_getSelectedEntry:function(){var A=this;var I;var J=A._autoCompleteResultsList.one(j);if(J){I=J.text();}return I;},_handleArrows:function(N){var A=this;var M;if(N===r){M="previous";}else{if(N===F){M="next";}}if(M){var K=A._autoCompleteResultsList;var J=K.one(a);if(J){var L=J[M](i);if(L){J.removeClass(g);L.addClass(g);var O=K.get(s);var I=L.get(s);if(M==="previous"){if(I.top<O.top){L.scrollIntoView(true);}}else{if(I.top+I.height>O.bottom){L.scrollIntoView();}}}}return new B.Halt(null);}},_handlePageUpDown:function(P){var N=this;var K=N._autoCompleteResultsList;var O=N._getEntriesPerPage();var M=K.one(a);var A=parseInt(M.attr(w),0);var L;var Q=b;var I=false;if(P===d){L=A-O;I=true;}else{if(P===p){L=A+O;Q=":last-child";}}var J=K.one(z+"["+w+'="'+L+'"]');if(!J){J=K.one(z+Q);}if(M!==J){M.removeClass(g);J.addClass(g);J.scrollIntoView(I);}return new B.Halt(null);},_handleResultListClick:function(J){var A=this;var K=J.currentTarget;var I=A._autoCompleteResultsList.one(a);if(K!==I){I.removeClass(g);K.addClass(g);}A.fire("entrySelected",K);},_handleStartEnd:function(M){var A=this;
var K;var L=false;var J=A._autoCompleteResultsList;if(M===C){K=J.one(z+":last-child");}else{if(M===v){K=J.one(z);L=true;}}var I=J.one(a);if(K!==I){I.removeClass(g);K.addClass(g);K.scrollIntoView(L);}return new B.Halt(null);},_onResultsChange:function(M){var A=this;var I=A._autoCompleteResultsList;I.empty();var K=M.newVal;var L=A.TPL_ENTRY;D.each(K,function(O,N){I.appendChild(f.sub(L,{index:N,value:O}));});var J=I.one(z);if(J){J.addClass(g);}else{I.appendChild(A.TPL_RESULTS_EMPTY,f.sub({label:A.get("emptyMessage")}));}},TPL_ENTRY:'<li class="'+i+'" data-index="{index}">'+'<span class="'+n+'">{value}</span>'+"</li>",TPL_LIST:'<ul class="'+G+'"/>',TPL_RESULTS_EMPTY:'<li class="'+i+'">'+'<span class="'+l+'">{label}</span>'+"</li>"}});q.AceEditor.AutoCompleteList=m;},"@VERSION@",{requires:["aui-ace-editor","aui-search-ternary-search-tree","panel","plugin"],skinnable:true});