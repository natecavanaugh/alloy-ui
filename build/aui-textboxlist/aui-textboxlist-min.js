AUI.add("aui-textboxlist",function(p){var d=p.Lang,j=p.ClassNameManager.getClassName,b="textboxlistentry",h="textboxlist",x="boundingBox",m="contentBox",B={from:{opacity:1},to:{opacity:0.3},duration:0.1,on:{end:function(D){var A=this;var C=A.get("reverse");if(!C){A.run();}A.set("reverse",!C);}}},k=j("helper","clearfix"),l=j("icon"),w=j("icon","close"),q=j(b,"close","hover"),n=j(b,"close"),r=j(b,"holder"),u=j(b,"text"),a=j(b,"item"),t=j(h,"input","container"),v=8,g=13,y=37,i=39,f='<span class="'+[l,w,n].join(" ")+'"></span>',o='<span class="'+u+'"></span>',e='<ul class="'+[k,r].join(" ")+'"></ul>',z='<li class="'+t+'"></li>';var s=p.Component.create({NAME:h,ATTRS:{allowAnyEntry:{value:false},delimChar:{value:""},tabIndex:{value:0}},EXTENDS:p.AutoComplete,prototype:{initializer:function(C){var A=this;var D=A.get("matchKey");A.entries=new p.DataSet({getKey:function(F){var E=this;return F[D];}});A._lastSelectedEntry=-1;},renderUI:function(){var A=this;A._renderEntryHolder();s.superclass.renderUI.apply(A,arguments);A._overlayAlign.node=A.get(x);},bindUI:function(){var D=this;s.superclass.bindUI.apply(D,arguments);D.after("itemSelect",D._afterItemSelect);D.after("focusedChange",D._afterTBLFocusedChange);D.on("click",D._onBoundingBoxClick);var C=D.entries;var E=D.entryHolder;var A="."+w;C.after("add",D._updateEntryHolder,D);C.after("replace",D._updateEntryHolder,D);C.after("remove",D._updateEntryHolder,D);E.delegate("click",p.bind(D._removeItem,D),A);E.delegate("mouseenter",p.bind(D._onCloseIconMouseOver,D),A);E.delegate("mouseleave",p.bind(D._onCloseIconMouseOut,D),A);p.on("key",D._onTBLKeypress,D.get(x),"down:39,40,37,38,8,13",D);D.inputNode.on("focus",D._onInputNodeFocus,D);},add:function(C){var A=this;var D=A._prepareEntry(C);A.entries.add(D);},addEntries:function(A){var A=this;var C=A.inputNode;A.entries.add(C.val(),{});},insert:function(D,C){var A=this;var E=A._prepareEntry(C);return A.entries.insert(D,E);},remove:function(C){var A=this;return A.entries.removeKey(C);},_afterItemSelect:function(C){var A=this;A.entries.add(C._resultData);},_afterTBLFocusedChange:function(D){var A=this;if(D.type.indexOf("textboxlistentry")>-1){if(D.newVal){var C=D.target.get(x);A._lastSelectedEntry=A.entryHolder.all("li").indexOf(C);}}},_onBoundingBoxClick:function(C){var A=this;A.inputNode.focus();},_onCloseIconMouseOut:function(C){var A=this;C.currentTarget.removeClass(q);},_onCloseIconMouseOver:function(C){var A=this;C.currentTarget.addClass(q);},_onInputNodeFocus:function(C){var A=this;A._lastSelectedEntry=-1;},_onTBLKeypress:function(C){var N=this;var O=C.keyCode;var K=N.inputNode;if(!K.val()){var M=N._lastSelectedEntry;var D=-1;var E=(M==-1);var F=(O==v);var H=(F&&E);var I=O==y||H;var A=(O==i);var G=N.entries;var L=G.size();var J=L-1;if(I){if(E){D=J;}else{if(M==0){D=M;}else{D=M-1;}}}else{if(A){if(E||(M==J)){D=-1;}else{D=M+1;}}else{if(F){G.removeAt(M);L=G.size();if(M==L){D=-1;}else{D=M;}}}}if(H||F){C.halt();}if(D!=-1){G.item(D).entry.focus();}else{K.focus();}N._lastSelectedEntry=D;}else{if(O==g&&N.get("allowAnyEntry")){N.addEntries();}}},_onTextboxKeyPress:function(C){var A=this;s.superclass._onTextboxKeyPress.apply(A,arguments);if(C.keyCode==g){C.halt();}},_prepareEntry:function(C){var A=this;var E={};var D=A.get("matchKey");E[D]=C;return E;},_realignContainer:function(C){var A=this;A.overlay.set("width",A.get(x).get("offsetWidth"));s.superclass._realignContainer.apply(A,arguments);},_removeItem:function(E){var A=this;var D=p.Widget.getByNode(E.currentTarget);D=D.get(x);var C=A.entryHolder.all("li").indexOf(D);A.entries.removeAt(C);},_renderEntryHolder:function(){var A=this;var C=A.get(m);var D=p.Node.create(e);C.prepend(D);A.entryHolder=D;},_renderInput:function(){var C=this;var E=C.get(m);var F=C.get("input");var G={labelText:false};var A=null;if(F){F=p.one(F);G.node=F;A=F.get("parentNode");}var I=p.Node.create(z);C.entryHolder.append(I);var D=new p.Textfield(G).render(I);var H=D.get(x);if(H.get("parentNode")!=I){I.appendChild(H);}C.inputContainer=I;C.inputField=D;C.inputNode=D.get("node");C.button=new p.ButtonItem();C.set("uniqueName",p.stamp(C.inputNode));},_updateEntryHolder:function(C){var K=this;var D=C.type;var G=K.inputNode;var A=K.entryHolder;var M=C.item;var F=C.index;var L=K.get("matchKey");var J=M[L]||C.attrName;if(J){if(D=="dataset:add"){var H=new c({labelText:J});H.addTarget(K);var I=H.get(x);H.render(A);A.all("li").item(F).placeBefore(I);I.plug(p.Plugin.NodeFX,B);M.entry=H;G.val("");}else{if(D=="dataset:replace"){G.val("");var H=C.prevVal.entry;M.entry=H;H.get(x).fx.run();}else{if(D=="dataset:remove"){var E=A.all("li");if(E){E.item(F).remove();}}}}}else{K.entries.removeAt(F);}}}});var c=p.Component.create({NAME:b,ATTRS:{labelText:{value:""},tabIndex:{value:0}},prototype:{BOUNDING_TEMPLATE:"<li></li>",CONTENT_TEMPLATE:"<span></span>",renderUI:function(){var A=this;var C=A.get(m);var F=p.Node.create(o);var E=p.Node.create(f);var D=p.Escape.html(A.get("labelText"));F.set("innerHTML",D);C.appendChild(F);C.appendChild(E);}}});p.TextboxList=s;p.TextboxListEntry=c;},"@VERSION@",{requires:["anim-node-plugin","aui-autocomplete","escape","node-focusmanager"],skinnable:true});