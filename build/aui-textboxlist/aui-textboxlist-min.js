AUI.add("aui-textboxlist",function(r){var e=r.Lang,i=r.getClassName,b="textboxlistentry",h="textboxlist",B="boundingBox",o="contentBox",c="inputNode",x="itemName",D={from:{opacity:1},to:{opacity:0.3},duration:0.1,on:{end:function(F){var A=this;var E=A.get("reverse");if(!E){A.run();}A.set("reverse",!E);}}},j=i("helper","clearfix"),m=i("icon"),y=i("icon","close"),s=i(b,"close","hover"),p=i(b,"close"),t=i(b,"holder"),w=i(b,"text"),a=i(b,"item"),v=i(h,"input","container"),z="BACKSPACE",k="ENTER",n="LEFT",l="RIGHT",g='<span class="'+[m,y,p].join(" ")+'"></span>',q='<span class="'+w+'"></span>',f='<ul class="'+[j,t].join(" ")+'"></ul>',C='<li class="'+v+'"></li>';var u=r.Component.create({NAME:h,ATTRS:{align:{value:{node:o,points:["tl","bl"]}},allowAnyEntry:{value:false},delimChar:{value:""},inputNode:{valueFn:function(){return r.Node.create('<input type="text"/>');}},tabIndex:{value:0}},EXTENDS:r.AutoComplete,prototype:{initializer:function(E){var A=this;A.entries=new r.DataSet({getKey:function(G){var F=this;return G[x];}});A._lastSelectedEntry=-1;},renderUI:function(){var A=this;A._renderEntryHolder();A._renderInput();u.superclass.renderUI.apply(A,arguments);},bindUI:function(){var F=this;u.superclass.bindUI.apply(F,arguments);F.after("focusedChange",F._afterTBLFocusedChange);F.on("click",F._onBoundingBoxClick);var E=F.entries;var G=F.entryHolder;var A="."+y;E.after("add",F._updateEntryHolder,F);E.after("replace",F._updateEntryHolder,F);E.after("remove",F._updateEntryHolder,F);G.delegate("click",r.bind(F._removeItem,F),A);G.delegate("mouseenter",r.bind(F._onCloseIconMouseOver,F),A);G.delegate("mouseleave",r.bind(F._onCloseIconMouseOut,F),A);r.on("key",F._onTBLKeypress,F.get(B),"down:39,40,37,38,8,13",F);F.inputNode.on("focus",F._onInputNodeFocus,F);},add:function(F){var A=this;var E=A._prepareEntry(F);A.entries.add(E);},addEntries:function(A){var A=this;var E=A.inputNode;A.entries.add(E.val(),{});},insert:function(F,E){var A=this;var G=A._prepareEntry(E);return A.entries.insert(F,G);},remove:function(E){var A=this;return A.entries.removeKey(E);},selectItem:function(F){var A=this;var E=F._data.result.text;A.add(E);},_afterTBLFocusedChange:function(F){var A=this;if(F.type.indexOf("textboxlistentry")>-1){if(F.newVal){var E=F.target.get(B);A._lastSelectedEntry=A.entryHolder.all("li").indexOf(E);}}},_onBoundingBoxClick:function(E){var A=this;A.inputNode.focus();},_onCloseIconMouseOut:function(E){var A=this;E.currentTarget.removeClass(s);},_onCloseIconMouseOver:function(E){var A=this;E.currentTarget.addClass(s);},_onInputNodeFocus:function(E){var A=this;A._lastSelectedEntry=-1;},_onTBLKeypress:function(E){var P=this;var M=P.inputNode;if(!M.val()){var O=P._lastSelectedEntry;var F=-1;var G=(O==-1);var H=E.isKey(z);var J=(H&&G);var K=E.isKey(n)||J;var A=E.isKey(l);var I=P.entries;var N=I.size();var L=N-1;if(K){if(G){F=L;}else{if(O==0){F=O;}else{F=O-1;}}}else{if(A){if(G||(O==L)){F=-1;}else{F=O+1;}}else{if(H){I.removeAt(O);N=I.size();if(O==N){F=-1;}else{F=O;}}}}if(J||H){E.halt();}if(F!=-1){I.item(F).entry.focus();}else{M.focus();}P._lastSelectedEntry=F;}else{if(E.isKey(k)&&P.get("allowAnyEntry")){P.addEntries();}}},_onTextboxKeyPress:function(E){var A=this;u.superclass._onTextboxKeyPress.apply(A,arguments);if(E.isKey(k)){E.halt();}},_prepareEntry:function(F){var A=this;var E={};E[x]=F;return E;},_removeItem:function(G){var A=this;var F=r.Widget.getByNode(G.currentTarget);F=F.get(B);var E=A.entryHolder.all("li").indexOf(F);A.entries.removeAt(E);},_renderEntryHolder:function(){var A=this;var E=A.get(o);var F=r.Node.create(f);E.prepend(F);A.entryHolder=F;},_renderInput:function(){var A=this;var F=A.get(o);var G=A.get(c);var H={labelText:false,node:G};var J=r.Node.create(C);A.entryHolder.append(J);var E=new r.Textfield(H).render(J);var I=E.get(B);if(I.get("parentNode")!=J){J.appendChild(I);}A.inputContainer=J;A.inputField=E;A.inputNode=E.get("node");},_updateEntryHolder:function(E){var M=this;var F=E.type;var I=M.inputNode;var A=M.entryHolder;var N=E.item;var H=E.index;var L=N[x]||E.attrName;if(L){if(F=="dataset:add"){var J=new d({labelText:L});J.addTarget(M);var K=J.get(B);J.render(A);A.all("li").item(H).placeBefore(K);K.plug(r.Plugin.NodeFX,D);N.entry=J;I.val("");}else{if(F=="dataset:replace"){I.val("");var J=E.prevVal.entry;N.entry=J;J.get(B).fx.run();}else{if(F=="dataset:remove"){var G=A.all("li");if(G){G.item(H).remove();}}}}}else{M.entries.removeAt(H);}}}});var d=r.Component.create({NAME:b,ATTRS:{labelText:{value:""},tabIndex:{value:0}},prototype:{BOUNDING_TEMPLATE:"<li></li>",CONTENT_TEMPLATE:"<span></span>",renderUI:function(){var A=this;var E=A.get(o);var F=A.get("labelText");var H=r.Node.create(g);var G=r.Node.create(q);G.set("innerHTML",F);E.appendChild(G);E.appendChild(H);}}});r.TextboxList=u;r.TextboxListEntry=d;},"@VERSION@",{skinnable:true,requires:["anim-node-plugin","aui-base","aui-data-set","aui-form-textfield","autocomplete","autocomplete-filters","autocomplete-highlighters"]});