AUI.add("aui-scheduler-event",function(aG){var al=aG.Lang,bb=al.isString,h=al.isDate,a1=al.isFunction,I=al.isObject,a5=al.isBoolean,ab=al.isNumber,aS=aG.ColorUtil,l=aG.DataType.DateMath,aY=aG.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),az=":",bq="-",i=".",ac="",bs="&ndash;",bp=" ",H="_",T="activeView",w="all",M="allDay",V="borderColor",aH="borderColorRGB",aE="borderStyle",bi="borderWidth",K="Change",aV="color",aP="colorBrightnessFactor",a6="colorSaturationFactor",aC="content",a4="day",t="disabled",aI="endDate",aL="eventClass",ar="hidden",J="hsbColor",aq="icon",Z="icons",ai="inherit",aQ="isoTime",bh="locale",be="meeting",aT="never",p="node",k="overlay",bo="recorder",ae="reminder",ba="repeated",a3="repeater",af="scheduler",at="scheduler-event",av="scheduler-event-recorder",a="short",bd="startDate",aZ="template",aO="title",g="titleDateFormat",ao="visible",f="%H:%M",N="%l",bl="%M",am=function(A){var L=[N];if(A.getMinutes()>0){L.push(az);L.push(bl);}if(A.getHours()>=12){L.push("p");}return L.join(ac);},G=aG.getClassName,m=G(aq),s=G(at),F=G(at,w,a4),aJ=G(at,aC),a8=G(at,t),B=G(at,ar),u=G(at,aq,t),D=G(at,aq,be),ap=G(at,aq,ae),d=G(at,aq,ba),bg=G(at,Z),b=G(at,be),an=G(at,bo),o=G(at,ae),ay=G(at,ba),ak=G(at,a),C=G(at,aO);var X=aG.Component.create({NAME:at,ATTRS:{allDay:{setter:aG.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:bb},borderWidth:{value:"1px",validator:bb},colorBrightnessFactor:{value:0.75,validator:ab},colorSaturationFactor:{value:1.5,validator:ab},content:{value:"(no title)",validator:bb},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bb},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this,L=A.get(af),bv=L&&L.get(T).get(aQ),bw={endDate:bs+bp+f,startDate:f};if(!bv){bw.endDate=bs+bp+am(A.get(aI));bw.startDate=am(A.get(bd));}if(A.getMinutesDuration()<=30){delete bw.endDate;}else{if(A.get(M)){bw={};}}return bw;}},endDate:{setter:"_setDate",valueFn:function(){var A=l.clone(this.get(bd));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aG.SchedulerEvent;}},disabled:{value:false,validator:a5},meeting:{value:false,validator:a5},node:{valueFn:function(){return aG.NodeList.create(aG.Node.create(this.EVENT_NODE_TEMPLATE).setData(at,this));}},reminder:{value:false,validator:a5},repeated:{value:false,validator:a5},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:a5}},EXTENDS:aG.Base,PROPAGATE_ATTRS:[bd,aI,aC,aV,aP,a6,aE,bi,g,ao,t],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+s+'">'+'<div class="'+C+'"></div>'+'<div class="'+aJ+'"></div>'+'<div class="'+bg+'">'+'<span class="'+[m,u].join(bp)+'"></span>'+'<span class="'+[m,D].join(bp)+'"></span>'+'<span class="'+[m,ap].join(bp)+'"></span>'+'<span class="'+[m,d].join(bp)+'"></span>'+"</div>"+"</div>",initializer:function(){var A=this;var L=A.get(p);A.bindUI();A.syncUI();},bindUI:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,colorChange:A._afterColorChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,meetingChange:A._afterMeetingChange,reminderChange:A._afterReminderChange,repeatedChange:A._afterRepeatedChange,visibleChange:A._afterVisibleChange});},syncUI:function(){var A=this;A._uiSetAllDay(A.get(M));A._uiSetColor(A.get(aV));A._uiSetDisabled(A.get(t));A._uiSetEndDate(A.get(aI));A._uiSetMeeting(A.get(be));A._uiSetReminder(A.get(ae));A._uiSetRepeated(A.get(ba));A._uiSetVisible(A.get(ao));A.syncNodeTitleUI();A.syncNodeContentUI();},destroy:function(){var A=this;A.get(p).remove(true);},addPaddingNode:function(){var A=this;A.get(p).push(aG.Node.create(A.EVENT_NODE_TEMPLATE).setData(at,A));A.syncUI();},copyDates:function(L){var A=this;A.set(aI,l.clone(L.get(aI)));A.set(bd,l.clone(L.get(bd)));},copyPropagateAttrValues:function(L,bv){var A=this;A.copyDates(L);aG.Array.each(A.get(aL).PROPAGATE_ATTRS,function(bw){if(!((bv||{}).hasOwnProperty(bw))){var bx=L.get(bw);if(!I(bx)){A.set(bw,bx);}}});},getBorderColor:function(){var A=this;return A[aH].hex;},getDaysDuration:function(){var A=this;return l.getDayOffset(A.get(aI),A.get(bd));},getHoursDuration:function(){var A=this;return l.getHoursOffset(A.get(aI),A.get(bd));},getMinutesDuration:function(){var A=this;return l.getMinutesOffset(A.get(aI),A.get(bd));},getSecondsDuration:function(){var A=this;return l.getSecondsOffset(A.get(aI),A.get(bd));},sameEndDate:function(L){var A=this;return l.compare(A.get(aI),L.get(aI));},sameStartDate:function(L){var A=this;return l.compare(A.get(bd),L.get(bd));},isAfter:function(bw){var bv=this;var L=bv.get(bd);var A=bw.get(bd);return l.after(L,A);},isBefore:function(bw){var bv=this;var L=bv.get(bd);var A=bw.get(bd);return l.before(L,A);},intersects:function(bw){var bv=this;var bx=bv.get(aI);var L=bv.get(bd);var A=bw.get(bd);return(bv.sameStartDate(bw)||l.between(A,L,bx));},intersectHours:function(bv){var L=this;var bx=L.get(aI);var A=L.get(bd);var bw=l.clone(A);l.copyHours(bw,bv.get(bd));return(l.compare(A,bw)||l.between(bw,A,bx));},isDayBoundaryEvent:function(){var A=this;return l.isDayBoundary(A.get(bd),A.get(aI));},isDayOverlapEvent:function(){var A=this;return l.isDayOverlap(A.get(bd),A.get(aI));},getClearEndDate:function(){var A=this;return l.safeClearTime(A.get(aI));},getClearStartDate:function(){var A=this;return l.safeClearTime(A.get(bd));},move:function(L){var A=this;var bv=A.getMinutesDuration();A.set(bd,L);A.set(aI,l.add(l.clone(L),l.MINUTES,bv));},setContent:function(L){var A=this;A.get(p).each(function(bw){var bv=bw.one(i+aJ);bv.setContent(L);});},setTitle:function(L){var A=this;A.get(p).each(function(bv){var bw=bv.one(i+C);bw.setContent(L);});},syncNodeContentUI:function(){var A=this;A.setContent(A.get(aC));},syncNodeTitleUI:function(){var L=this,bw=L.get(g),A=L.get(bd),bv=L.get(aI),bx=[];if(bw.startDate){bx.push(L._formatDate(A,bw.startDate));}if(bw.endDate){bx.push(L._formatDate(bv,bw.endDate));}L.setTitle(bx.join(bp));
},split:function(){var A=this,bv=l.clone(A.get(bd)),bw=l.clone(A.get(aI));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=l.clone(bv);L.setHours(24,0,0,0);return[[bv,l.toMidnight(l.clone(bv))],[L,l.clone(bw)]];}return[[bv,bw]];},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterColorChange:function(L){var A=this;A._uiSetColor(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterMeetingChange:function(L){var A=this;A._uiSetMeeting(L.newVal);},_afterReminderChange:function(L){var A=this;A._uiSetReminder(L.newVal);},_afterRepeatedChange:function(L){var A=this;A._uiSetRepeated(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_setColor:function(L){var A=this;A[J]=aS.rgb2hsb(aS.getRGB(L));A[V]=aG.clone(A[J]);A[V].b*=A.get(aP);A[V].s*=A.get(a6);A[aH]=aS.hsb2rgb(A[V]);return L;},_setDate:function(L){var A=this;if(ab(L)){L=new Date(L);}return L;},_setScheduler:function(bv){var A=this;var L=A.get(af);if(L){A.removeTarget(L);}A.addTarget(bv);return bv;},_formatDate:function(bv,bw){var L=this;var A=L.get(bh);return aG.DataType.Date.format(bv,{format:bw,locale:A});},_getTitleDateFormat:function(L){var A=this;if(bb(L)){L={endDate:L,startDate:L};}else{if(a1(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(p).toggleClass(F,!!L);},_uiSetColor:function(bw){var A=this;var bv=A.get(p);var bx=A.getBorderColor();if(bv){var L={borderWidth:A.get(bi),borderColor:bx,backgroundColor:bw,borderStyle:A.get(aE),color:ai};bv.setStyles(L);}},_uiSetDisabled:function(L){var A=this;A.get(p).toggleClass(a8,!!L);},_uiSetEndDate:function(L){var A=this;A.get(p).toggleClass(ak,A.getMinutesDuration()<=30);},_uiSetMeeting:function(L){var A=this;A.get(p).toggleClass(b,!!L);},_uiSetReminder:function(L){var A=this;A.get(p).toggleClass(o,!!L);},_uiSetRepeated:function(L){var A=this;A.get(p).toggleClass(ay,!!L);},_uiSetVisible:function(L){var A=this;A.get(p).toggleClass(B,!L);}}});aG.SchedulerEvent=X;var au=aG.Lang,c=au.isArray,e="arrow",aN="body",ax="bodyContent",aX="bottom",q="boundingBox",aw="cancel",aU="click",E="constrain",aM="date",aD="dateFormat",aj="delete",a2="description",bn="event",z="footerContent",aB="form",y="header",R="offsetHeight",a9="offsetWidth",U="overlayOffset",bk="rendered",j="right",aW="save",n="schedulerChange",aA="shadow",Q="strings",bm="tl",aa="toolbar",bc="submit",bf="value",aK="visibleChange",S="width",ad="cancel",P="delete",x="edit",aF="save",r=aG.IO.prototype._serialize,br=G(af,bn,bo,k),v=G(af,bn,bo,k,e),bj=G(af,bn,bo,k,e,aX),aR=G(af,bn,bo,k,e,j),a7=G(af,bn,bo,k,e,aA),ah=G(af,bn,bo,k,aN),a0=G(af,bn,bo,k,aC),ag=G(af,bn,bo,k,aM),W=G(af,bn,bo,k,aB),bu=G(af,bn,bo,k,y),O=new aG.Template('<div class="',a7," ",v,'"></div>','<div class="',v,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bu,'">','<input class="',a0,'" name="content" value="{content}" />',"</div>",'<div class="',ah,'">','<label class="',ag,'">{date}</label>',"</div>"),bt='<form class="'+W+'" id="schedulerEventRecorderForm"></form>';var Y=aG.Component.create({NAME:av,ATTRS:{allDay:{value:false},content:{value:ac},duration:{value:60},dateFormat:{validator:bb,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aG.SchedulerEvent;}},strings:{value:{},setter:function(A){return aG.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's",cancel:"Cancel",description:"Description",edit:"Edit",save:"Save",when:"When"},A||{});},validator:I},overlay:{validator:I,value:{constrain:null,visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:c},template:{value:O},toolbar:{setter:function(bv){var L=this;var A=L.get(Q);return aG.merge({children:[{handler:aG.bind(L._handleSaveEvent,L),label:A[aW]},{handler:aG.bind(L._handleCancelEvent,L),label:A[aw]},{handler:aG.bind(L._handleDeleteEvent,L),label:A[aj]}]},bv||{});},validator:I,value:{}}},EXTENDS:aG.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(p).addClass(an);A.publish(ad,{defaultFn:A._defCancelEventFn});A.publish(P,{defaultFn:A._defDeleteEventFn});A.publish(x,{defaultFn:A._defEditEventFn});A.publish(aF,{defaultFn:A._defSaveEventFn});A.after(n,A._afterSchedulerChange);A[k]=new aG.Overlay(A.get(k));A[aa]=new aG.Toolbar(A.get(aa));},_afterSchedulerChange:function(bw){var A=this;var bv=bw.newVal;var L=bv.get(q);A[k].set(E,L);L.delegate(aU,aG.bind(A._onClickSchedulerEvent,A),i+s);},_defCancelEventFn:function(L){var A=this;A.get(p).remove();A.hideOverlay();},_defDeleteEventFn:function(bv){var A=this;var L=A.get(af);L.removeEvent(A.get(bn));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(bv){var A=this;var L=A.get(af);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(bv){var A=this;var L=A.get(af);L.addEvent(bv.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ad);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(P,{schedulerEvent:A.get(bn)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bn)?x:aF,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(bv){var A=this;var L=bv.currentTarget.getData(at);if(L){A.set(bn,L);A.showOverlay([bv.pageX,bv.pageY]);A.get(p).remove();}},_onOverlayVisibleChange:function(bw){var L=this;if(bw.newVal){L.populateForm();if(!L.get(bn)){var bv=L[k].get(q);var A=bv.one(i+a0);setTimeout(function(){A.selectText();},0);}}else{L.set(bn,null);L.get(p).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(Q);L[k].render();L[aa].render();var bv=L[k].get(q);bv.addClass(br);L[k].set(z,L[aa].get(q));L[k].on(aK,aG.bind(L._onOverlayVisibleChange,L));L.formNode=aG.Node.create(bt);L[k].set(ax,L.formNode);L.formNode.on(bc,aG.bind(L._onSubmitForm,L));
},getEventCopy:function(){var A=this;var bv=A.get(bn);if(!bv){bv=new (A.get(aL))({allDay:A.get(M),endDate:A.get(aI),scheduler:A.get(af),startDate:A.get(bd)});bv.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();bv.set(aC,L[aC]);bv.set(ba,L[ba]);return bv;},getFormattedDate:function(){var bv=this;var L=bv.get(aD);var bx=(bv.get(bn)||bv);var bz=bx.get(aI);var by=bx.get(af);var A=bx.get(bd);var bw=(by.get(T).get(aQ)?l.toIsoTimeString:l.toUsTimeString);return[bx._formatDate(A,L),bw(A),bq,bw(bz)].join(bp);},getTemplateData:function(){var L=this;var A=L.get(Q);var bv=(L.get(bn)||L);return{content:bv.get(aC)||A["description-hint"],date:L.getFormattedDate(),endDate:bv.get(aI).getTime(),repeated:bv.get(ba),startDate:bv.get(bd).getTime()};},hideOverlay:function(){var A=this;A[k].hide();},populateForm:function(){var A=this;A.formNode.setContent(A.get(aZ).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aG.QueryString.parse(r(A.formNode.getDOM()));},showOverlay:function(bE,bv){var bD=this,bB=bD[k].get(E),bw=bD.get(U),bz=bE.concat([]);if(!bD[k].get(bk)){bD._renderOverlay();}bD[k].show();if(!bE){var bA=(bD.get(bn)||bD).get(p);var L=bA.one(i+C);bv=[bw[0]+L.get(a9),bw[1]+L.get(R)/2];bE=L.getXY();}bv=bv||bw;bE[0]+=bv[0];bE[1]+=bv[1];var A=bD[k].get(q),by=A.get(a9),bx=A.one(i+bu),bC=A.all(i+v);if((bE[0]+by)>=bB.get(a9)){bC.addClass(aR);bE[0]-=by+bC.item(0).get(a9);}bD[k].set("xy",bE);if(bz[1]>=(bx.get(R)+bx.getY())){bC.addClass(bj);}else{bC.removeClass(bj);}}}});aG.SchedulerEventRecorder=Y;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});