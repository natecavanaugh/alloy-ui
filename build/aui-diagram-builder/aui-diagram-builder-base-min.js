AUI.add("aui-diagram-builder-base",function(ai){var X=ai.Lang,d=X.isArray,ax=X.isBoolean,O=X.isNumber,F=X.isObject,aB=X.isString,M=function(A){return(A instanceof ai.ArrayList);},V=function(A){return(A instanceof ai.Node);},H=function(A){return(A instanceof ai.AvailableField);},aK=ai.Array,Y="add",o="addNode",aJ="auto",P="availableField",T="availableFields",aG="availableFieldsDragConfig",v="boundingBox",aD="builder",ac="cancel",af="canvas",az="clearfix",f="column",a="container",ag="content",y="contentBox",e="contentContainer",S="contentNode",I="createDocumentFragment",D="diagram",ao="diagram-builder",ad="disk",r="draggable",aF="drop",ar="dropConfig",ab="dropContainer",aw="field",w="fields",q="fieldsContainer",av="height",s="helper",aa="icon",z="iconClass",aq="id",am="label",x="layout",ap="list",R="maxFields",u="node",g="parentNode",ah="propertyList",aE="rendered",at="save",t="settings",Q="tab",K="tabView",b="tabs",h="tabview",N="toolbar",m="toolbarContainer",C=ai.getClassName,aI=" ",i=".",j="#",aI=" ",E="_",n=C(f),B=C(D,aD,af),aj=C(D,aD,ag,a),G=C(D,aD,aF,a),ay=C(D,aD,aw),l=C(D,aD,aw,r),c=C(D,aD,aw,aa),ae=C(D,aD,aw,am),Z=C(D,aD,w,a),ak=C(D,aD,Q,Y),L=C(D,aD,Q,t),au=C(D,aD,b),U=C(D,aD,b,ag),an=C(D,aD,N,a),al=C(s,az),p=C(aa),J=C(x),aC=C(h,ag),aH=C(h,ap);var k=ai.Component.create({NAME:P,ATTRS:{draggable:{value:true,validator:ax},label:{validator:aB},iconClass:{validator:aB},id:{value:ai.guid(),setter:"_setId",validator:aB},node:{valueFn:function(aL){var A=this;if(!V(aL)){aL=ai.Node.create(ai.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(z)}));aL.setData(P,A);}return aL;},validator:V,writeOnce:true},type:{value:u,validator:aB}},EXTENDS:ai.Base,buildNodeId:function(A){return T+E+aw+E+A;},getAvailableFieldById:function(A){return ai.AvailableField.getAvailableFieldByNode(j+ai.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){var A=ai.one(A);if(V(ai.one(A))){return A.getData(P);}return null;},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+ay+'">'+'<span class="'+[p,c].join(aI)+' {iconClass}"></span>'+'<div class="'+ae+'"></div>'+"</li>",initializer:function(){var A=this;var aL=A.get(u);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aL.one(i+ae);A._uiSetDraggable(A.get(r));A._uiSetId(A.get(aq));A._uiSetLabel(A.get(am));},_afterDraggableChange:function(aL){var A=this;A._uiSetDraggable(aL.newVal);},_afterIdChange:function(aL){var A=this;A._uiSetId(aL.newVal);},_afterLabelChange:function(aL){var A=this;A._uiSetLabel(aL.newVal);},_setId:function(A){return ai.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aL){var A=this;A.get(u).toggleClass(l,aL);},_uiSetId:function(aL){var A=this;A.get(u).set(aq,aL);},_uiSetLabel:function(aL){var A=this;A.labelNode.setContent(aL);}}});ai.AvailableField=k;var W=function(){};W.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||M(A);}},maxFields:{value:Infinity,validator:O}};ai.mix(W.prototype,{_setFields:function(aL){var A=this;if(M(aL)){return aL;}else{return A.createFields(aL);}},_updateFields:function(aL){var A=this;A.set(w,aL);},addField:function(aM,aL){var A=this;if(A.get(w).size()<A.get(R)){var aN=A.createField(aM);if(aN){A._updateFields(A.get(w).add(aN,aL));}return aN;}return null;},createFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){if(aN<aL.get(R)){A.push(aL.createField(aO));}});return new ai.ArrayList(A);},removeField:function(aL){var A=this;A._updateFields(A.get(w).remove(aL));},createField:function(A){return A;}});ai.FieldSupport=W;var aA=ai.Component.create({NAME:ao,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:F},canvas:{valueFn:function(){return ai.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:F},contentContainer:{valueFn:function(){return ai.Node.create(this.CONTENT_CONTAINER_TEMPLATE);}},dropContainer:{valueFn:function(){return ai.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return ai.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:F,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:F,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:F,value:null},toolbarContainer:{valueFn:function(){return ai.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{contentContainer:i+aj,dropContainer:i+G,fieldsContainer:i+Z,toolbarContainer:i+an,canvas:i+B},UI_ATTRS:[T,w],AUGMENTS:[ai.FieldSupport],prototype:{CONTENT_CONTAINER_TEMPLATE:'<div class="'+aj+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+G+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+an+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[Z,al].join(aI)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+B+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender,"recordset:update":A._afterRecordsetUpdate});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(af);A.contentContainer=A.get(e);A.dropContainer=A.get(ab);A.fieldsContainer=A.get(q);A.toolbarContainer=A.get(m);},isAvailableFieldsDrag:function(aM){var A=this;var aL=A.availableFieldsDrag;return(aM===aL.dd);},plotFields:function(){var aL=this;var A=aL.get(w);A.each(function(aM){aL.plotField(aM);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(T));},syncUI:function(){var A=this;var aL=A.get(y);A._setupDrop();A._setupAvailableFieldsDrag();aL.addClass(J);},_afterActiveTabChange:function(aM){var A=this;var aL=aM.newVal.get(S);if(A.get(aE)&&(aL===A.settingsNode)){A._renderSettings();}},_afterRecordsetUpdate:function(aL){var A=this;
A._handleSaveEvent();},_afterRender:function(aL){var A=this;A.plotFields();},_afterUiSetHeight:function(aL){var A=this;A.contentContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);A.dropContainer.setStyle(av,O(aL)?aL+A.DEF_UNIT:aL);},_defCancelFn:function(aL){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(ac);},_handleSaveEvent:function(){var A=this;A.fire(at);},_renderCanvas:function(){var A=this;var aL=A.get(y);var aM=A.canvas;var aN=A.contentContainer;var aO=A.dropContainer;if(!aM.inDoc()){aN.appendChild(aM);}if(!aO.inDoc()){aM.appendChild(aO);}if(aN.inDoc()){aN.get(g).append(aN);}else{aL.appendChild(aN);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new ai.PropertyList(A.get(ah)).render(A.settingsNode);A.propertyList.get(v).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aL=new ai.TabView(A.get(K));aL.get(v);A.tabView=aL;A.fieldsNode=aL.getTab(0).get(S);A.settingsNode=aL.getTab(1).get(S);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new ai.Toolbar(A.get(N)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new ai.DD.Drop(A.get(ar));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new ai.DD.Delegate(A.get(aG));},_setAvailableFields:function(aM){var aL=this;var A=[];aK.each(aM,function(aO,aN){A.push(H(aO)?aO:new ai.AvailableField(aO));});return A;},_setDropConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,groups:[T],node:A.dropContainer},aL||{});},_setAvailableFieldsDragConfig:function(aL){var A=this;return ai.merge({bubbleTargets:A,container:A.get(v),dragConfig:{groups:[T],plugins:[{cfg:{moveOnEnd:false},fn:ai.Plugin.DDProxy}]},nodes:i+l},aL||{});},_setPropertyList:function(aL){var A=this;return ai.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aJ}},aL);},_setTabView:function(aO){var aL=this;var aN=aL.get(v);var aP=aN.one(i+aH);var aM={after:{activeTabChange:ai.bind(aL._afterActiveTabChange,aL)},boundingBox:aN.one(i+au),contentBox:aN.one(i+U),bubbleTargets:aL,contentNode:aN.one(i+aC),cssClass:au,listNode:aP,render:aL.get(y)};if(!aP){var A=aL.getStrings();aM.items=[{cssClass:ak,label:A[o]},{cssClass:L,label:A[t]}];}return ai.merge(aM,aO);},_setToolbar:function(aM){var aL=this;var A=aL.getStrings();return ai.merge({activeState:false,bubbleTargets:aL,children:[{handler:ai.bind(aL._handleCancelEvent,aL),label:A[ac]}]},aM);},_uiSetAvailableFields:function(aN){var A=this;var aM=A.fieldsNode;if(aM){var aL=ai.getDoc().invoke(I);aK.each(aN,function(aO){aL.appendChild(aO.get(u));});aM.setContent(A.fieldsContainer.setContent(aL));}},_uiSetFields:function(aL){var A=this;if(A.get(aE)){A.plotFields();}}}});ai.DiagramBuilderBase=aA;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});