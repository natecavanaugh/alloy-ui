AUI.add("aui-datatable-selection",function(s){var e=s.Lang,n=e.isArray,p=e.isString,m=e.isObject,v="CLASS_NAMES_SELECTION",j="activeCell",k="activeCoord",c="activeRow",f="activeCoordChange",x="boundingBox",i="cell",d="cellIndex",g="children",o="focused",b="key",l="mousedown",u="mouseenter",h="mouseup",t="selection",r="tabindex",w=".",q=function(A,z,y){return Math.min(Math.max(A,z),y);};var a=function(){};a.ATTRS={activeCell:{getter:"_getActiveCell"},activeCoord:{value:[-1,-1]},activeRow:{getter:"_getActiveRow"},selection:{setter:"_setSelection"},tabIndex:{value:0}};s.mix(a.prototype,{_capturing:false,_selectionEnd:null,_selectionSeed:null,_selectionStart:null,initializer:function(){var y=this,z=y.get(x);y[v]={cell:y.getClassName(i),selection:y.getClassName(t)};y._bindSelectionUI();z.addClass(y[v].selection);},destroy:function(){var y=this;y._selectionKeyHandler.detach();},captureSelection:function(C){var E=this,F=[],B=[],y=[],G=[],z;for(z=0;z<C.length;z++){var A=C[z],D=E.getCell(A);G.push(A[0]);F.push(D);B.push(E.getColumn(D));}G=s.Array.unique(G);B=s.Array.unique(B);for(z=0;z<G.length;z++){G[z]=E.getRow(G[z]);y[z]=E.getRecord(G[z]);}return{cells:F,cols:B,coords:C,records:y,rows:G};},getActiveColumn:function(){var y=this;return y.getColumn(y.get(j));},getActiveRecord:function(){var y=this;return y.getRecord(y.get(c));},getCoord:function(A){var z=this,y=z.getCell(A),B=z.body.tbodyNode,C=B.get("firstChild.rowIndex");return[y.get("parentNode.rowIndex")-C,y.get(d)];},_afterActiveCoordChange:function(A){var y=this,z=y.getCell(A.newVal);if(z){z.setAttribute(r,0).focus();}},_bindSelectionUI:function(){var y=this,z=y[v];y._selectionKeyHandler=s.getDoc().on(b,s.bind(y._onSelectionKey,y),"down:enter,37,38,39,40");y.after(f,y._afterActiveCellIndexChange);y.delegate(h,s.bind(y._onSelectionMouseUp,y),w+z.cell);y.delegate(l,s.bind(y._onSelectionMouseDown,y),w+z.cell);y.delegate(u,s.bind(y._onSelectionMouseEnter,y),w+z.cell);},_getActiveCell:function(){var y=this,z=y.get(k),B=z[0],A=z[1];if(B>-1&&A>-1){return y.getCell([B,A]);}return null;},_getActiveRow:function(){var y=this,z=y.get(k),A=z[0];if(A>-1){return y.getRow(A);}return null;},_onSelectionMouseDown:function(B){var y=this,z=B.currentTarget,A=y.get(x),C=y.getCoord(z);A.unselectable();y._capturing=true;y._selectionSeed=z;y._selectionStart=y._selectionEnd=y.getCoord(z);y.set(k,C);},_onSelectionMouseEnter:function(A){var y=this,z=A.currentTarget;if(!y._capturing){return;}y._selectionSeed=z;y._selectionEnd=y.getCoord(z);y.set(t,{start:y._selectionStart,end:y._selectionEnd});},_onSelectionMouseUp:function(A){var y=this,z=y.get(x);if(y.get(o)){y._selectionEnd=y.getCoord(y._selectionSeed);y.set(t,{start:y._selectionStart,end:y._selectionEnd});}z.selectable();y._capturing=false;},_onSelectionKey:function(z){var G=this,F=G.body,E=F.tbodyNode,H=z.keyCode,B=G.get(j),I,A=E.get(g).size(),y=F.get("columns").length,D,C;if(B&&G.get(o)){I=G.getCoord(B);D=I[0];C=I[1];if(H===37){C--;}else{if(H===38){D--;}else{if(H===39){C++;}else{if(H===40){D++;}}}}D=q(D,0,A-1);C=q(C,0,y-1);G.set(k,[D,C]);G.set(t,[D,C]);z.preventDefault();}},_parseRange:function(D){var B=D[0],A=D[1],C=[],z,y;for(z=Math.min(B[0],A[0]);z<=Math.max(B[0],A[0]);z++){for(y=Math.min(B[1],A[1]);y<=Math.max(B[1],A[1]);y++){C.push([z,y]);}}return C;},_setSelection:function(z){var y=this;if(n(z)){if(!n(z[0])){z=[z];}}else{if(m(z)){z=y._parseRange([z.start,z.end]);}else{if(s.instanceOf(z,s.Node)){z=[y.getCoord(z)];}}}return y.captureSelection(z);}});s.DataTable.Selection=a;s.Base.mix(s.DataTable,[a]);s.DataTable.prototype.getColumn=(function(y){return function(A){var z;if(s.instanceOf(A,s.Node)){z=this.getCell(A);A=z&&(z.get("className").match(new RegExp(this.getClassName("col","(\\w+)")))||[])[1];}return y.call(this,A);};}(s.DataTable.prototype.getColumn));s.DataTable.prototype.getRow=(function(y){return function(A){var z=this,B=z.body.tbodyNode,C;if(s.instanceOf(A,s.Node)){C=A.ancestor(function(D){return D.get("parentNode").compareTo(B);},true);return C;}else{return y.call(this,A);}};}(s.DataTable.prototype.getRow));s.DataTable.prototype._setColumns=function(z){var E={},F=[],B=[],C=s.Array.indexOf,A=s.Lang.isArray;function G(K){var L={},I,J,H;F.push(K);B.push(L);for(I in K){if(K.hasOwnProperty(I)){J=K[I];if(A(J)){L[I]=J.slice();}else{if(m(J,true)&&J.constructor===L.constructor){H=C(J,F);L[I]=H===-1?G(J):B[H];}else{L[I]=K[I];}}}}return L;}function D(H){H=H.replace(/\s+/,"-");if(E[H]){H+=(E[H]++);}else{E[H]=1;}return H;}function y(N,M){var L=[],K,H,I,J;for(K=0,H=N.length;K<H;++K){L[K]=I=p(N[K])?{key:N[K]}:G(N[K]);J=s.stamp(I);if(!I.id){I.id=J;}if(I.field){I.name=I.field;}if(M){I._parent=M;}else{delete I._parent;}I._id=D(I.name||I.key||I.id);if(A(I.children)){I.children=y(I.children,I);}}return L;}return z&&y(z);};},"@VERSION@",{skinnable:true,requires:["datatable-base"]});