AUI.add("aui-datatable-edit",function(au){var ad=au.Lang,bf=au.Array,e=ad.isArray,aS=ad.isBoolean,aO=ad.isFunction,J=ad.isObject,aX=ad.isString,aw=ad.isValue,aN=ad.String,a9=au.DataType,a4=function(A){return(A instanceof au.BaseCellEditor);},aq=au.WidgetStdMod,B=au.getClassName,aZ="activeCell",af="add",a5="addOption",aM="baseCellEditor",s="boundingBox",R="calendar",am="cancel",aQ="cell",az="celleditor",C="checkboxCellEditor",p="checked",aI="click",w="contentBox",aF="data",Q="datatable",M="dateCellEditor",al="dd",V="delete",ap="disk",aH="dotted",aP="dropDownCellEditor",N="edit",G="editEvent",ai="editOptions",Z="editable",g="editor",I="element",aE="elementName",c="grip",F="handle",v="hide",ax="hideOnSave",ah="icon",o="initEdit",be="initToolbar",av="initValidator",ab="input",d="inputFormatter",bd="key",ay="label",ar="link",X="mousedown",aa="multiple",m="name",aL="only",aU="option",a0="options",u="optionsCellEditor",ba="outputFormatter",l="pencil",aj="radioCellEditor",i="read",ak="readOnly",bb="remove",f="render",a7="rendered",ag="return",n="row",aK="save",aV="selected",aC="selectedAttrName",Y="showToolbar",aY="submit",S="textAreaCellEditor",y="textCellEditor",P="toolbar",z="unescapeValue",W="validator",a3="value",at="vertical",ae="visible",a1="wrapper",D="zIndex",bi=",",j=".",T="",a6="\n",bc=" ",t=/<br\s*\/?>/gi,E=/[\r\n]/g,b=B(az,N),h=B(az,N,af,aU),bh=B(az,N,al,F),aT=B(az,N,V,aU),a8=B(az,N,v,aU),aA=B(az,N,ab,m),aJ=B(az,N,ab,a3),ao=B(az,N,ay),q=B(az,N,ar),aD=B(az,N,aU,n),U=B(az,I),aW=B(az,ay),L=B(az,aU),x=B(az,a1),H=B(Q,Z),k=B(ah),ac=B(ah,c,aH,at),aR="<br/>";var a2=function(){};a2.NAME="dataTableCellEditorSupport";a2.EDITOR_ZINDEX=9999;a2.ATTRS={editEvent:{setter:"_setEditEvent",validator:aX,value:aI}};au.mix(a2.prototype,{initializer:function(){var A=this,bj=A.get(G);A.CLASS_NAMES_CELL_EDITOR_SUPPORT={cell:A.getClassName(aQ),readOnly:A.getClassName(i,aL)};A.after(f,A._afterCellEditorSupportRender);A.delegate(bj,A._onEditCell,j+A.CLASS_NAMES_CELL_EDITOR_SUPPORT.cell,A);},getEditor:function(bj,bl){var A=this,bk=bl.editor,bm=bj.get(g);if(bk===false||bm===false){return null;}return bm||bk;},_afterCellEditorSupportRender:function(){var A=this;A._syncModelsReadOnlyUI();A.body.after(au.bind(A._syncModelsReadOnlyUI,A),A.body,f);},_onEditCell:function(bo){var A=this,bl=A.get(aZ),bk=bo.alignNode||bl,bn=A.getColumn(bk),bj=A.getRecord(bk),bm=A.getEditor(bj,bn);if(a4(bm)&&!bj.get(ak)){if(!bm.get(a7)){bm.on({visibleChange:au.bind(A._onEditorVisibleChange,A),save:au.bind(A._onEditorSave,A)});bm.set(D,a2.EDITOR_ZINDEX);bm.render();}bm.set(a3,bj.get(bn.key));bm.show().move(bk.getXY());}},_onEditorSave:function(bm){var A=this,bl=bm.currentTarget,bk=A.getActiveColumn(),bj=A.getActiveRecord();bl.set(a3,bm.newVal);A.set(aZ,A.get(aZ));bj.set(bk.key,bm.newVal);if(A.highlight){A.highlight.clear();}},_onEditorVisibleChange:function(bk){var A=this,bj=bk.currentTarget;if(bk.newVal){bj._syncFocus();}},_syncModelReadOnlyUI:function(bj){var A=this,bk=A.getRow(bj);bk.toggleClass(A.CLASS_NAMES_CELL_EDITOR_SUPPORT[ak],bj.get(ak)===true);},_syncModelsReadOnlyUI:function(){var A=this;A.get(aF).each(function(bj){A._syncModelReadOnlyUI(bj);});},getCellEditor:function(){return this.getEditor.apply(this,arguments);},getRecordColumnValue:function(A,bj){return A.get(bj.key);}});au.DataTable.CellEditorSupport=a2;au.Base.mix(au.DataTable,[a2]);var r=au.Component.create({NAME:aM,ATTRS:{editable:{value:false,validator:aS},elementName:{value:a3,validator:aX},footerContent:{value:T},hideOnSave:{value:true,validator:aS},inputFormatter:{value:function(A){if(aX(A)){A=A.replace(E,aR);}return A;}},outputFormatter:{value:function(bj){var A=this;if(aX(bj)){if(A.get(z)){bj=aN.unescapeEntities(bj);}bj=bj.replace(t,a6);}return bj;}},showToolbar:{value:true,validator:aS},strings:{value:{edit:"Edit",save:"Save",cancel:"Cancel"}},tabIndex:{value:1},toolbar:{setter:"_setToolbar",validator:J,value:null},unescapeValue:{value:true,validator:aS},validator:{setter:"_setValidator",validator:J,value:null},value:{value:T},visible:{value:false}},EXTENDS:au.Overlay,UI_ATTRS:[Z,Y,a3],prototype:{CONTENT_TEMPLATE:"<form></form>",ELEMENT_TEMPLATE:null,elements:null,validator:null,_hDocMouseDownEv:null,initializer:function(bj){var A=this;A._initEvents();},destructor:function(){var bj=this;var A=bj._hDocMouseDownEv;var bl=bj.toolbar;var bk=bj.validator;if(A){A.detach();}if(bl){bl.destroy();}if(bk){bk.destroy();}},bindUI:function(){var A=this;A.get(s).on(bd,au.bind(A._onEscKey,A),"down:27");},formatValue:function(bj,bk){var A=this;if(aO(bj)){bk=bj.call(A,bk);}return bk;},getValue:function(){var A=this;return A.formatValue(A.get(d),A.getElementsValue());},_initEvents:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn},initEdit:{defaultFn:A._defInitEditFn,fireOnce:true},initValidator:{defaultFn:A._defInitValidatorFn,fireOnce:true},initToolbar:{defaultFn:A._defInitToolbarFn,fireOnce:true},save:{defaultFn:A._defSaveFn}});A.after({render:A._afterRender,visibleChange:au.debounce(A._debounceVisibleChange,350,A)});A.on({"form-validator:submit":au.bind(A._onSubmit,A)});},_afterRender:function(){var A=this;A._handleInitValidatorEvent();A._handleInitToolbarEvent();},_defCancelFn:function(bj){var A=this;A.hide();},_defInitValidatorFn:function(bj){var A=this;A.validator=new au.FormValidator(A.get(W));},_defInitToolbarFn:function(bk){var A=this;var bj=A.get(Z);A.toolbar=new au.Toolbar(A.get(P)).render(A.footerNode);if(bj){A._uiSetEditable(bj);}},_defSaveFn:function(bj){var A=this;if(A.get(ax)){A.hide();}},_debounceVisibleChange:function(bk){var bj=this;var A=bj._hDocMouseDownEv;if(bk.newVal){if(!A){bj._hDocMouseDownEv=au.getDoc().on(X,au.bind(bj._onDocMouseDownExt,bj));}}else{if(A){A.detach();bj._hDocMouseDownEv=null;}}},_handleCancelEvent:function(){var A=this;A.fire(am);},_handleEditEvent:function(){var A=this;A.fire(N);},_handleInitEditEvent:function(){var A=this;if(A.get(a7)){this.fire(o);}},_handleInitValidatorEvent:function(){var A=this;if(A.get(a7)){this.fire(av);
}},_handleInitToolbarEvent:function(){var A=this;if(A.get(a7)&&A.get(Y)){this.fire(be);}},_handleSaveEvent:function(){var A=this;if(!A.validator.hasErrors()){A.fire(aK,{newVal:A.getValue(),prevVal:A.get(a3)});}},_onDocMouseDownExt:function(bk){var A=this;var bj=A.get(s);if(!bj.contains(bk.target)){A.set(ae,false);}},_onEscKey:function(bj){var A=this;A.hide();},_onSubmit:function(bk){var A=this;var bj=bk.validator;A._handleSaveEvent();if(bj){bj.formEvent.halt();}},_setToolbar:function(bk){var bj=this;var A=bj.getStrings();return au.merge({activeState:false,children:[{label:A[aK],icon:ap,type:aY},{handler:au.bind(bj._handleCancelEvent,bj),label:A[am]}]},bk);},_setValidator:function(bj){var A=this;return au.merge({boundingBox:A.get(w),bubbleTargets:A},bj);},_uiSetShowToolbar:function(bk){var A=this;var bj=A.footerNode;if(bk){bj.show();}else{bj.hide();}A._handleInitToolbarEvent();},getElementsValue:function(){var A=this;var bj=A.elements;if(bj){return bj.get(a3);}return T;},renderUI:function(){var A=this;if(A.ELEMENT_TEMPLATE){A.elements=au.Node.create(A.ELEMENT_TEMPLATE);A._syncElementsName();A.setStdModContent(aq.BODY,A.elements);}},_defInitEditFn:function(A){},_syncElementsFocus:function(){var A=this;A.elements.selectText();},_syncElementsName:function(){var A=this;A.elements.setAttribute(m,A.get(aE));},_syncFocus:function(){var A=this;au.later(0,A,A._syncElementsFocus);},_uiSetEditable:function(bk){var A=this;var bj=A.toolbar;if(A.get(a7)&&bj){if(bk){bj.add({handler:au.bind(A._handleEditEvent,A),icon:l,label:A.getString(N)},1);}else{bj.remove(1);}}},_uiSetValue:function(bk){var A=this;var bj=A.elements;if(bj){bj.val(A.formatValue(A.get(ba),bk));}}}});au.BaseCellEditor=r;var bg=au.Component.create({NAME:u,ATTRS:{inputFormatter:{value:null},options:{setter:"_setOptions",value:{},validator:J},outputFormatter:{value:null},selectedAttrName:{value:aV,validator:aX},strings:{value:{add:"Add",cancel:"Cancel",addOption:"Add option",edit:"Edit options",editOptions:"Edit option(s)",name:"Name",remove:"Remove",save:"Save",stopEditing:"Stop editing",value:"Value"}}},EXTENDS:au.BaseCellEditor,UI_ATTRS:[a0],prototype:{EDIT_TEMPLATE:'<div class="'+b+'"></div>',EDIT_OPTION_ROW_TEMPLATE:'<div class="'+aD+'">'+'<span class="'+[bh,k,ac].join(bc)+'"></span>'+'<input class="'+aA+'" size="7" placeholder="{titleName}" title="{titleName}" type="text" value="{valueName}" /> '+'<input class="'+aJ+'" size="7" placeholder="{titleValue}" title="{titleValue}" type="text" value="{valueValue}" /> '+'<a class="'+[q,aT].join(bc)+'" href="javascript:void(0);">{remove}</a> '+"</div>",EDIT_ADD_LINK_TEMPLATE:'<a class="'+[q,h].join(bc)+'" href="javascript:void(0);">{addOption}</a> ',EDIT_LABEL_TEMPLATE:'<div class="'+ao+'">{editOptions}</div>',editContainer:null,editSortable:null,options:null,initializer:function(){var A=this;A.on(N,A._onEditEvent);A.on(aK,A._onSave);A.after(be,A._afterInitToolbar);},addNewOption:function(bl,bm){var A=this;var bk=A.editContainer.one(j+h);var bj=au.Node.create(A._createEditOption(bl||T,bm||T));bk.placeBefore(bj);bj.one(ab).focus();},removeOption:function(A){A.remove();},saveOptions:function(){var A=this;var bm=A.editContainer;if(bm){var bl=bm.all(j+aA);var bj=bm.all(j+aJ);var bk={};bl.each(function(bp,bo){var bn=bp.val();var bq=bj.item(bo).val();if(bn&&bq){bk[bq]=bn;}});A.set(a0,bk);A._uiSetValue(A.get(a3));A.toggleEdit();}},toggleEdit:function(){var A=this;A.editContainer.toggle();},_createOptions:function(bk){var bo=this;var A=bo.elements;var bm=[];var bj=[];var bl=bo.OPTION_TEMPLATE;var bp=bo.OPTION_WRAPPER;au.each(bk,function(bt,bs){var br={id:au.guid(),label:bt,name:bs,value:bs};if(bl){bm.push(ad.sub(bl,br));}if(bp){bj.push(ad.sub(bp,br));}});var bq=au.NodeList.create(bm.join(T));var bn=au.NodeList.create(bj.join(T));if(bn.size()){bn.each(function(bs,br){bs.prepend(bq.item(br));});A.setContent(bn);}else{A.setContent(bq);}bo.options=bq;},_createEditBuffer:function(){var bj=this;var A=bj.getStrings();var bk=[];bk.push(ad.sub(bj.EDIT_LABEL_TEMPLATE,{editOptions:A[ai]}));au.each(bj.get(a0),function(bl,bm){bk.push(bj._createEditOption(bl,bm));});bk.push(ad.sub(bj.EDIT_ADD_LINK_TEMPLATE,{addOption:A[a5]}));return bk.join(T);},_createEditOption:function(bk,bl){var bj=this;var A=bj.getStrings();return ad.sub(bj.EDIT_OPTION_ROW_TEMPLATE,{remove:A[bb],titleName:A[m],titleValue:A[a3],valueName:bk,valueValue:bl});},_defInitEditFn:function(bj){var A=this;var bk=au.Node.create(A.EDIT_TEMPLATE);bk.delegate("click",au.bind(A._onEditLinkClickEvent,A),j+q);bk.delegate("keydown",au.bind(A._onEditKeyEvent,A),ab);A.editContainer=bk;A.setStdModContent(aq.BODY,bk.hide(),aq.AFTER);A.editSortable=new au.Sortable({container:bk,handles:[j+bh],nodes:j+aD,opacity:".3"}).delegate.dd.plug(au.Plugin.DDConstrained,{constrain:bk,stickY:true});A._syncEditOptionsUI();},_getSelectedOptions:function(){var A=this;var bj=[];A.options.each(function(bk){if(bk.get(A.get(aC))){bj.push(bk);}});return au.all(bj);},_onEditEvent:function(bj){var A=this;A._handleInitEditEvent();A.toggleEdit();A._syncEditOptionsUI();},_onEditLinkClickEvent:function(bj){var A=this;var bk=bj.currentTarget;if(bk.test(j+h)){A.addNewOption();}else{if(bk.test(j+a8)){A.toggleEdit();}else{if(bk.test(j+aT)){A.removeOption(bk.ancestor(j+aD));}}}bj.halt();},_onEditKeyEvent:function(bj){var A=this;var bk=bj.currentTarget;if(bj.isKey(ag)){var bl=bk.next(ab);if(bl){bl.selectText();}else{A.addNewOption();}bj.halt();}},_onSave:function(bj){var A=this;A.saveOptions();},_setOptions:function(bj){var A={};if(e(bj)){bf.each(bj,function(bk){A[bk]=bk;});}else{if(J(bj)){A=bj;}}return A;},_syncEditOptionsUI:function(){var A=this;A.editContainer.setContent(A._createEditBuffer());},_uiSetOptions:function(bj){var A=this;A._createOptions(bj);A._uiSetValue(A.get(a3));A._syncElementsName();},_uiSetValue:function(bk){var A=this;var bj=A.options;if(bj&&bj.size()){bj.set(A.get(aC),false);if(aw(bk)){if(!e(bk)){bk=String(bk).split(bi);}bf.each(bk,function(bl){bj.filter('[value="'+ad.trim(bl)+'"]').set(A.get(aC),true);
});}}return bk;}}});au.BaseOptionsCellEditor=bg;var aB=au.Component.create({NAME:y,EXTENDS:au.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<input autocomplete="off" class="'+U+'" type="text" />'}});au.TextCellEditor=aB;var aG=au.Component.create({NAME:S,EXTENDS:au.BaseCellEditor,prototype:{ELEMENT_TEMPLATE:'<textarea class="'+U+'"></textarea>'}});au.TextAreaCellEditor=aG;var O=au.Component.create({NAME:aP,ATTRS:{multiple:{value:false,validator:aS}},EXTENDS:au.BaseOptionsCellEditor,UI_ATTRS:[aa],prototype:{ELEMENT_TEMPLATE:'<select class="'+U+'"></select>',OPTION_TEMPLATE:'<option value="{value}">{label}</option>',getElementsValue:function(){var A=this;if(A.get(aa)){return A._getSelectedOptions().get(a3);}return A.elements.get(a3);},_syncElementsFocus:function(){var A=this;A.elements.focus();},_uiSetMultiple:function(bk){var A=this;var bj=A.elements;if(bk){bj.setAttribute(aa,aa);}else{bj.removeAttribute(aa);}}}});au.DropDownCellEditor=O;var an=au.Component.create({NAME:C,ATTRS:{selectedAttrName:{value:p}},EXTENDS:au.BaseOptionsCellEditor,prototype:{ELEMENT_TEMPLATE:'<div class="'+U+'"></div>',OPTION_TEMPLATE:'<input class="'+L+'" id="{id}" name="{name}" type="checkbox" value="{value}"/>',OPTION_WRAPPER:'<label class="'+x+'" for="{id}"><span class="'+aW+'">{label}</span></label>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(a3);},_syncElementsFocus:function(){var A=this;var bj=A.options;if(bj&&bj.size()){bj.item(0).focus();}},_syncElementsName:function(){var A=this;var bj=A.options;if(bj){bj.setAttribute(m,A.get(aE));}}}});au.CheckboxCellEditor=an;var K=au.Component.create({NAME:aj,EXTENDS:au.CheckboxCellEditor,prototype:{OPTION_TEMPLATE:'<input class="aui-field-input-choice" id="{id}" name="{name}" type="radio" value="{value}"/>',getElementsValue:function(){var A=this;return A._getSelectedOptions().get(a3)[0];}}});au.RadioCellEditor=K;var a=au.Component.create({NAME:M,EXTENDS:au.BaseCellEditor,ATTRS:{bodyContent:{value:T},calendar:{setter:"_setCalendar",validator:J,value:null},dateFormat:{value:"%D",validator:aX},inputFormatter:{value:function(bk){var A=this,bj=[];bf.each(bk,function(bm,bl){bj.push(A.formatDate(bm).toString());});return bj;}},outputFormatter:{value:function(bk){var A=this,bj=[];bf.each(bk,function(bm,bl){bj.push(a9.Date.parse(bm));});return bj;}}},prototype:{ELEMENT_TEMPLATE:'<input class="'+U+'" type="hidden" />',initializer:function(){var A=this;A.after("calendar:dateClick",au.bind(A._afterDateSelect,A));},getElementsValue:function(){var A=this;return A.calendar.get("selectedDates");},formatDate:function(bl){var bj=this,bk=bj.get("dateFormat"),A=bj.get("locale");return a9.Date.format(bl,{format:bk,locale:A});},_afterDateSelect:function(bk){var A=this,bj=A.calendar.get("selectedDates");A.elements.val(bf.invoke(bj,"getTime").join(bi));},_afterRender:function(){var A=this;au.DateCellEditor.superclass._afterRender.apply(A,arguments);A.calendar=new au.Calendar(A.get(R)).render(A.bodyNode);},_setCalendar:function(bj){var A=this;return au.merge({bubbleTargets:A},bj);},_uiSetValue:function(bl){var A=this,bk=A.calendar,bj;if(bk){if(!e(bl)){bl=[bl];}bj=A.formatValue(A.get(ba),bl);bk._clearSelection();bk.set("date",bj[0]);bk.selectDates(bj);}}}});au.DateCellEditor=a;},"@VERSION@",{requires:["datatable-base","calendar","aui-datatype","aui-toolbar","aui-form-validator","overlay","sortable"],skinnable:true});